<div>
  <div class="flex items-center justify-between mt-4 mb-6">
    <h1 class="font-extrabold text-3xl text-[#1E293B] opacity-95">Employés</h1>
    <button id="ajouter-departement" class="flex justify-around gap-2" (click)="ajouterEmployeDialog.open()" hlmBtn>
      <i class="fa-solid fa-plus"></i>
      <span class="sr-only sm:not-sr-only">Ajouter un Employé</span>
    </button>
  </div>

  <!-- Add Employé Dialog -->
  <hlm-dialog #ajouterEmployeDialog>
    <hlm-dialog-content class="sm:max-w-[425px]" *brnDialogContent="let ctx">
      <hlm-dialog-header>
        <h3 hlmDialogTitle>Ajouter un Employé</h3>
        <p hlmDialogDescription>
          Ajouter les informations de l'employé(e) ici. Cliquez sur Enregistrer
          lorsque vous avez terminé.
        </p>
      </hlm-dialog-header>
      <form [formGroup]="addForm" class="flex flex-col gap-4 items-center w-full overflow-y-scroll max-h-96 px-5 pb-2">
        <div class="py-4 grid gap-4">
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="cin" class="text-left">Cin</label>
            <input hlmInput id="cin" name="cin" formControlName="cin" type="text" class="w-72" minlength="8" maxlength="8" />
            <div *ngIf="addForm.controls['cin'].invalid && (addForm.controls['cin'].dirty || addForm.controls['cin'].touched)">
              <small *ngIf="addForm.controls['cin'].errors?.['required']" class="text-red-700">CIN est obligatoire</small>
              <small *ngIf="addForm.controls['cin'].errors?.['pattern']" class="text-red-700">Le champ CIN doit contenir uniquement des chiffres.</small>
              <small *ngIf="addForm.controls['cin'].errors?.['minlength']" class="text-red-700">CIN doit comporter au moins 8 chiffres</small>
            </div>


          </div>
          <div class="flex flex-col gap-4 w-full">
            <div class="flex flex-col gap-4 w-full">
              <label hlmLabel for="nomComplet" class="text-left">Nom et prénom</label>
              <input hlmInput id="nomComplet" name="nomComplet" formControlName="nomComplet" type="text" class="w-72" minlength="4" />
              <div *ngIf="addForm.get('nomComplet').invalid && (addForm.get('nomComplet').dirty || addForm.get('nomComplet').touched)">
                <small *ngIf="addForm.get('nomComplet').errors['required']" class="text-red-700">Nom est obligatoire.</small>
                <small *ngIf="addForm.get('nomComplet').errors['minlength']" class="text-red-700">Le nom doit comporter au moins 4 caractères.</small>
              </div>
            </div>

          </div>
          <div class="flex flex-col gap-4 w-full">
            <div class="flex flex-col gap-4 w-full">
              <label hlmLabel for="qualification" class="text-left">Qualification</label>
              <input hlmInput id="qualification" name="qualification" formControlName="qualification" type="text" class="w-72" minlength="4" />
              <div *ngIf="addForm.get('qualification').invalid && (addForm.get('qualification').dirty || addForm.get('qualification').touched)">
                <small *ngIf="addForm.get('qualification').errors['required']" class="text-red-700">Qualification est obligatoire.</small>
                <small *ngIf="addForm.get('qualification').errors['minlength']" class="text-red-700">Qualification doit comporter au moins 4 caractères.</small>
              </div>
            </div>

          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="sexe" class="text-left">Sexe</label>
            <brn-select class="inline-block" id="sexe" formControlName="sexe" placeholder="Sélectionner le sexe">
              <hlm-select-trigger class="w-72">
                <hlm-select-value />
              </hlm-select-trigger>
              <hlm-select-content>
                <hlm-option value="MALE">Male</hlm-option>
                <hlm-option value="FEMALE">Female</hlm-option>
              </hlm-select-content>
            </brn-select>
            <div *ngIf="addForm.get('sexe').invalid && (addForm.get('sexe').dirty || addForm.get('sexe').touched)">
              <small *ngIf="addForm.get('sexe').errors['required']" class="text-red-700">Le champ sexe est obligatoire.</small>
            </div>
          </div>

          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="telephone" class="text-left">Num de Telephone</label>
            <input hlmInput id="telephone" name="telephone" formControlName="telephone" type="text" class="w-72" maxlength="8"  />
            <div *ngIf="addForm.get('telephone').invalid && (addForm.get('telephone').dirty || addForm.get('telephone').touched)">
              <small *ngIf="addForm.get('telephone').errors['required']" class="text-red-700">Le champ telephone est obligatoire.</small>
              <small *ngIf="addForm.get('telephone').errors['minlength']" class="text-red-700">Le telephone doit comporter 8 nombre.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="dob" class="text-left">date de naissance</label>
            <input  hlmInput id="dob" name="dob" formControlName="dob" type="date" class="w-72" />
            <div *ngIf="addForm.get('dob').invalid && (addForm.get('dob').dirty || addForm.get('dob').touched)">
              <small *ngIf="addForm.get('dob').errors['required']" class="text-red-700">Le champ date de naissance est obligatoire.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="doj" class="text-left">date d'adhésion</label>
            <input hlmInput id="doj" name="doj" formControlName="doj" type="date" class="w-72" />
            <div *ngIf="addForm.get('doj').invalid && (addForm.get('doj').dirty || addForm.get('doj').touched)">
              <small *ngIf="addForm.get('doj').errors['required']" class="text-red-700">Le champ date d'adhésion est obligatoire.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="departementId" class="text-left">Département</label>
            <brn-select class="inline-block" id="departementId" formControlName="departementId"
              placeholder="Sélectionner un Département">
              <hlm-select-trigger class="w-72">
                <hlm-select-value />
              </hlm-select-trigger>
              <hlm-select-content>
                @for (dep of departements; track $index) {
                <hlm-option value="{{ dep.id }}">{{ dep.name }}</hlm-option>
                }
              </hlm-select-content>
            </brn-select>
            <div *ngIf="addForm.get('departementId').invalid && (addForm.get('departementId').dirty || addForm.get('departementId').touched)">
              <small *ngIf="addForm.get('departementId').errors['required']" class="text-red-700">Vous devez choisir un département.</small>
            </div>
          </div>
        </div>
      </form>
      <hlm-dialog-footer>
        <button hlmBtn type="button" (click)="passDialog(ctx); addUser()">
          Sauvegarder
        </button>
      </hlm-dialog-footer>
    </hlm-dialog-content>
  </hlm-dialog>

  <!-- Update Employé Dialog -->
  <hlm-dialog #modifieremployeDialog>
    <hlm-dialog-content class="sm:max-w-[425px]" *brnDialogContent="let ctx">
      <hlm-dialog-header>
        <h3 hlmDialogTitle>Modifier Employé(e)</h3>
      </hlm-dialog-header>
      <form [formGroup]="updateForm"
        class="flex flex-col gap-4 items-center w-full overflow-y-scroll max-h-96 px-5 pb-2">
        <div class="py-4 flex flex-col justify-center items-center gap-4">
          <div class="flex items-center p-4 border border-border space-x-4 rounded-md">
            @if(this.userEnabled){
            <hlm-icon size="lg" name="lucideMonitorCheck" />
            <div class="flex-1 space-y-1">
              <p class="text-sm font-medium leading-none">Compte Activé</p>
              <p class="text-sm text-muted-foreground">
                Cet employé peut se connecter à son compte.
              </p>
            </div>
            }@else {
            <hlm-icon size="lg" name="lucideMonitorOff" />
            <div class="flex-1 space-y-1">
              <p class="text-sm font-medium leading-none">Compte Désactivé</p>
              <p class="text-sm text-muted-foreground">
                Cet employé ne peut pas se connecter à son compte.
              </p>
            </div>
            }
            <hlm-switch class="ml-4" id="enabled" name="enabled"
              (changed)="this.userEnabled = this.updateForm.value.enabled" formControlName="enabled"
              aria-label="Enabled" />
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="cin" class="text-left">Cin</label>
            <input hlmInput id="cin" name="cin" formControlName="cin" type="text" minlength="8" maxlength="8" />
            <div *ngIf="updateForm.controls['cin'].invalid && (updateForm.controls['cin'].dirty || updateForm.controls['cin'].touched)">
              <small *ngIf="updateForm.controls['cin'].errors?.['required']" class="text-red-700">CIN est obligatoire</small>
              <small *ngIf="updateForm.controls['cin'].errors?.['pattern']" class="text-red-700">Le champ CIN doit contenir uniquement des chiffres.</small>
              <small *ngIf="updateForm.controls['cin'].errors?.['minlength']" class="text-red-700">CIN doit comporter au moins 8 chiffres</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="nomComplet" class="text-left">Nom et prénom</label>
            <input hlmInput id="nomComplet" name="nomComplet" formControlName="nomComplet" type="text" minlength="4" />
            <div *ngIf="updateForm.get('nomComplet').invalid && (updateForm.get('nomComplet').dirty || updateForm.get('nomComplet').touched)">
              <small *ngIf="updateForm.get('nomComplet').errors['required']" class="text-red-700">Nom est obligatoire.</small>
              <small *ngIf="updateForm.get('nomComplet').errors['minlength']" class="text-red-700">Le nom doit comporter au moins 4 caractères.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="qualification" class="text-left">Qualification</label>
            <input hlmInput id="qualification" name="qualification" formControlName="qualification" type="text" minlength="4" />
            <div *ngIf="updateForm.get('qualification').invalid && (updateForm.get('qualification').dirty || updateForm.get('qualification').touched)">
              <small *ngIf="updateForm.get('qualification').errors['required']" class="text-red-700">Qualification est obligatoire.</small>
              <small *ngIf="updateForm.get('qualification').errors['minlength']" class="text-red-700">Qualification doit comporter au moins 4 caractères.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="sexe" class="text-left">Sexe</label>
            <brn-select class="inline-block" id="sexe" formControlName="sexe" placeholder="Sélectionner le sexe">
              <hlm-select-trigger class="w-full">
                <hlm-select-value />
              </hlm-select-trigger>
              <hlm-select-content>
                <hlm-option value="MALE">Male</hlm-option>
                <hlm-option value="FEMALE">Female</hlm-option>
              </hlm-select-content>
            </brn-select>
            <div *ngIf="updateForm.get('sexe').invalid && (updateForm.get('sexe').dirty || updateForm.get('sexe').touched)">
              <small *ngIf="updateForm.get('sexe').errors['required']" class="text-red-700">Le champ sexe est obligatoire.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="telephone" class="text-left">Num de Telephone</label>
            <input hlmInput id="telephone" name="telephone" formControlName="telephone" type="text" maxlength="8" />
            <div *ngIf="updateForm.get('telephone').invalid && (updateForm.get('telephone').dirty || updateForm.get('telephone').touched)">
              <small *ngIf="updateForm.get('telephone').errors['required']" class="text-red-700">Le champ telephone est obligatoire.</small>
              <small *ngIf="updateForm.get('telephone').errors['minlength']" class="text-red-700">Le telephone doit comporter 8 nombre.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="dob" class="text-left">date de naissance</label>
            <input hlmInput id="dob" name="dob" formControlName="dob" type="date" />
            <div *ngIf="updateForm.get('dob').invalid && (updateForm.get('dob').dirty || updateForm.get('dob').touched)">
              <small *ngIf="updateForm.get('dob').errors['required']" class="text-red-700">Le champ date de naissance est obligatoire.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="doj" class="text-left">date d'adhésion</label>
            <input hlmInput id="doj" name="doj" formControlName="doj" type="date" />
            <div *ngIf="updateForm.get('doj').invalid && (updateForm.get('doj').dirty || updateForm.get('doj').touched)">
              <small *ngIf="updateForm.get('doj').errors['required']" class="text-red-700">Le champ date d'adhésion est obligatoire.</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="departementId" class="text-left">Département</label>
            <brn-select class="inline-block" id="departementId" formControlName="departementId"
              placeholder="Sélectionner un Département">
              <hlm-select-trigger class="w-full">
                <hlm-select-value />
              </hlm-select-trigger>
              <hlm-select-content>
                @for (dep of departements; track $index) {
                <hlm-option value="{{ dep.id }}">{{ dep.name }}</hlm-option>
                }
              </hlm-select-content>
            </brn-select>
            <div *ngIf="updateForm.get('departementId').invalid && (updateForm.get('departementId').dirty || updateForm.get('departementId').touched)">
              <small *ngIf="updateForm.get('departementId').errors['required']" class="text-red-700">Vous devez choisir un département.</small>
            </div>
          </div>
          <div class="flex w-full items-center p-4 border border-border space-x-4 rounded-md">
            @if(this.userIndependant){
            <div class="flex-1 space-y-1">
              <p class="text-sm font-medium leading-none">
                Cet employé est indépendant
              </p>
            </div>
            }@else {
            <div class="flex-1 space-y-1">
              <p class="text-sm font-medium leading-none">
                Cet employé est n'est pas indépendant
              </p>
            </div>
            }
            <hlm-switch class="ml-4" (changed)="this.userIndependant = this.updateForm.value.independant"
              formControlName="independant" id="independant" name="independant" aria-label="Independant" />
          </div>
        </div>
      </form>
      <hlm-dialog-footer class="">
        <div class="w-full flex items-center justify-between gap-4">
          <button hlmBtn variant='secondary' (click)="passDialog(ctx); resetPass()">
            <hlm-icon size="sm" class="mr-2" name="lucideKey" />
            Réinitialiser
          </button>
          <button hlmBtn type="button" (click)="passDialog(ctx); updateUser()">
            Sauvegarder
          </button>
        </div>
      </hlm-dialog-footer>
    </hlm-dialog-content>
  </hlm-dialog>

  <!-- Update Solde Dialog -->
  <hlm-dialog #modifiersoldeDialog>
    <hlm-dialog-content class="w-full sm:max-w-[500px] sm:min-w-[425px]" *brnDialogContent="let ctx">
      <hlm-dialog-header>
        <h3 hlmDialogTitle>Modifier Le Solde</h3>
      </hlm-dialog-header>
      <form [formGroup]="soldeForm"
        class="flex flex-col gap-4 items-center w-full overflow-y-scroll max-h-96 px-5 pb-2">
        <div class="py-4 flex flex-col justify-center w-full items-center gap-4">
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="totalCongeJours" class="text-left">Total de Congé (Jours)</label>
            <input hlmInput id="totalCongeJours" name="totalCongeJours" formControlName="totalCongeJours" type="text" minlength="1" maxlength="10" />
            <div *ngIf="soldeForm.controls['totalCongeJours'].invalid && (soldeForm.controls['totalCongeJours'].dirty || soldeForm.controls['totalCongeJours'].touched)">
              <small *ngIf="soldeForm.controls['totalCongeJours'].errors?.['required']" class="text-red-700">Ce champ est obligatoire</small>
              <small *ngIf="soldeForm.controls['totalCongeJours'].errors?.['pattern']" class="text-red-700">Ce champ doit contenir uniquement des chiffres.</small>
              <small *ngIf="soldeForm.controls['totalCongeJours'].errors?.['minlength']" class="text-red-700">Ce champ doit comporter au moins 1 chiffres</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="prisCongeJours" class="text-left">Pris de Conge (Jours)</label>
            <input hlmInput id="prisCongeJours" name="prisCongeJours" formControlName="prisCongeJours" type="text" minlength="1" maxlength="10" />
            <div *ngIf="soldeForm.controls['prisCongeJours'].invalid && (soldeForm.controls['prisCongeJours'].dirty || soldeForm.controls['prisCongeJours'].touched)">
              <small *ngIf="soldeForm.controls['prisCongeJours'].errors?.['required']" class="text-red-700">Ce champ est obligatoire</small>
              <small *ngIf="soldeForm.controls['prisCongeJours'].errors?.['pattern']" class="text-red-700">Ce champ doit contenir uniquement des chiffres.</small>
              <small *ngIf="soldeForm.controls['prisCongeJours'].errors?.['minlength']" class="text-red-700">Ce champ doit comporter au moins 1 chiffres</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="compteurSortie" class="text-left">Compteur de Sortie</label>
            <input hlmInput id="compteurSortie" name="compteurSortie" formControlName="compteurSortie" type="text" minlength="1" maxlength="10" />
            <div *ngIf="soldeForm.controls['compteurSortie'].invalid && (soldeForm.controls['compteurSortie'].dirty || soldeForm.controls['compteurSortie'].touched)">
              <small *ngIf="soldeForm.controls['compteurSortie'].errors?.['required']" class="text-red-700">Ce champ est obligatoire</small>
              <small *ngIf="soldeForm.controls['compteurSortie'].errors?.['pattern']" class="text-red-700">Ce champ doit contenir uniquement des chiffres.</small>
              <small *ngIf="soldeForm.controls['compteurSortie'].errors?.['minlength']" class="text-red-700">Ce champ doit comporter au moins 1 chiffres</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="totalSortieMin" class="text-left">Total de Sortie (Minutes)</label>
            <input hlmInput id="totalSortieMin" name="totalSortieMin" formControlName="totalSortieMin" type="text" minlength="1" maxlength="10" />
            <div *ngIf="soldeForm.controls['totalSortieMin'].invalid && (soldeForm.controls['totalSortieMin'].dirty || soldeForm.controls['totalSortieMin'].touched)">
              <small *ngIf="soldeForm.controls['totalSortieMin'].errors?.['required']" class="text-red-700">Ce champ est obligatoire</small>
              <small *ngIf="soldeForm.controls['totalSortieMin'].errors?.['pattern']" class="text-red-700">Ce champ doit contenir uniquement des chiffres.</small>
              <small *ngIf="soldeForm.controls['totalSortieMin'].errors?.['minlength']" class="text-red-700">Ce champ doit comporter au moins 1 chiffres</small>
            </div>
          </div>
          <div class="flex flex-col gap-4 w-full">
            <label hlmLabel for="prisSortieMin" class="text-left">Pris de Sortie (Minutes)</label>
            <input hlmInput id="prisSortieMin" name="prisSortieMin" formControlName="prisSortieMin" type="text" minlength="1" maxlength="10" />
            <div *ngIf="soldeForm.controls['prisSortieMin'].invalid && (soldeForm.controls['prisSortieMin'].dirty || soldeForm.controls['prisSortieMin'].touched)">
              <small *ngIf="soldeForm.controls['prisSortieMin'].errors?.['required']" class="text-red-700">Ce champ est obligatoire</small>
              <small *ngIf="soldeForm.controls['prisSortieMin'].errors?.['pattern']" class="text-red-700">Ce champ doit contenir uniquement des chiffres.</small>
              <small *ngIf="soldeForm.controls['prisSortieMin'].errors?.['minlength']" class="text-red-700">Ce champ doit comporter au moins 1 chiffres</small>
            </div>
          </div>
        </div>
      </form>
      <hlm-dialog-footer>
        <button hlmBtn type="button" (click)="passDialog(ctx); updateSolde()">
          Sauvegarder
        </button>
      </hlm-dialog-footer>
    </hlm-dialog-content>
  </hlm-dialog>

  <!-- Deletion Confirmation Dialog -->
  <hlm-alert-dialog #supprimeremployeDialog>
    <hlm-alert-dialog-content *brnAlertDialogContent="let ctx">
      <hlm-alert-dialog-header>
        <h3 hlmAlertDialogTitle>Etes-vous absolument sûr ?</h3>
        <p hlmAlertDialogDescription>Cette action ne peut pas être annulée.</p>
      </hlm-alert-dialog-header>
      <hlm-alert-dialog-footer>
        <button hlmAlertDialogCancel (click)="ctx.close()">Cancel</button>
        <button hlmAlertDialogAction (click)="passDialog(ctx); deleteUser()">
          Supprimer l'Employé
        </button>
      </hlm-alert-dialog-footer>
    </hlm-alert-dialog-content>
  </hlm-alert-dialog>

  <ul class="mx-auto mt-2 divide-y shadow-none rounded-xl">
    @for (department of departements; track department) {
    <li class="shadow-lg mb-5">
      <details open class="group">
        <summary
          class="bg-[#1E293B] hover:bg-gray-700 text-white flex items-center justify-between px-4 py-3 font-medium marker:content-none hover:cursor-pointer">
          <span class="pl-5">{{ department.name }}</span>
          <svg class="w-5 h-5 text-gray-200 hover:text-white transition group-open:rotate-90"
            xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" VoirBox="0 0 16 16">
            <path fill-rule="evenodd"
              d="M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z">
            </path>
          </svg>
        </summary>

        <article class="p-4">
          <!--Table ici-->
          <div class="relative overflow-x-auto shadow-none border">
            <table class="w-full text-sm text-left text-gray-500 dark:text-gray-400">
              <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">
                <tr>
                  <th scope="col" class="px-6 py-3">ID</th>
                  <th scope="col" class="px-6 py-3">NOM COMPLET</th>
                  <th scope="col" class="px-6 py-3">CIN</th>
                  <th scope="col" class="px-6 py-3">
                    <span class="sr-only">Actions</span>
                  </th>
                </tr>
              </thead>
              <tbody>
                @for (user of department.users; track $index) {
                <tr
                  class="bg-white border-t dark:bg-gray-800 dark:border-gray-700 hover:bg-gray-50 dark:hover:bg-gray-600">
                  <td class="px-6 py-4 text-gray-900 dark:text-white">
                    {{ $index + 1 }}
                  </td>
                  <td class="px-6 py-4">
                    {{ user.nomComplet }}
                  </td>
                  <td class="px-6 py-4">
                    {{ user.cin }}
                  </td>
                  <td class="px-6 py-4 text-right">
                    <button hlmBtn variant="ghost" class="h-6 w-6 p-0.5" align="end" [brnMenuTriggerFor]="menu">
                      <hlm-icon class="w-4 h-4" name="lucideMoreHorizontal" />
                    </button>
                    <ng-template #menu>
                      <hlm-menu>
                        <hlm-menu-label>Actions</hlm-menu-label>
                        <hlm-menu-separator />
                        <hlm-menu-group>
                          <button hlmMenuItem (click)="modifiersoldeDialog.open(); selectedUser(user.id, 1)" hlmMenuItem>
                            Solde
                          </button>
                          <button hlmMenuItem (click)="modifieremployeDialog.open(); selectedUser(user.id, 2)" hlmMenuItem>
                            Modifier
                          </button>
                          <button hlmMenuItem (click)="supprimeremployeDialog.open(); selectedUser(user.id, 3)" hlmMenuItem>
                            Supprimer
                          </button>
                        </hlm-menu-group>
                      </hlm-menu>
                    </ng-template>
                  </td>
                </tr>
                }
              </tbody>
            </table>
          </div>
        </article>
      </details>
    </li>
    }
  </ul>
</div>
