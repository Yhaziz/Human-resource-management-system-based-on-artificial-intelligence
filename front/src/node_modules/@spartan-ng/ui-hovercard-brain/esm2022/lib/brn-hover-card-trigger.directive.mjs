/**
 * We are building on shoulders of giants here and use the implementation provided by the incredible TaigaUI
 * team: https://github.com/taiga-family/taiga-ui/blob/main/projects/core/directives/dropdown/dropdown-hover.directive.ts
 * Check them out! Give them a try! Leave a star! Their work is incredible!
 */
import { FocusMonitor } from '@angular/cdk/a11y';
import { Directive, ElementRef, Input, NgZone, ViewContainerRef, inject, } from '@angular/core';
import { Subject, delay, distinctUntilChanged, fromEvent, map, merge, of, share, switchMap, takeUntil, tap, } from 'rxjs';
import { BrnHoverCardContentService } from './brn-hover-card-content.service';
import { createHoverObservable } from './createHoverObservable';
import * as i0 from "@angular/core";
export function isElement(node) {
    return !!node && `nodeType` in node && node.nodeType === Node.ELEMENT_NODE;
}
export class BrnHoverCardTriggerDirective {
    constructor() {
        this._destroy$ = new Subject();
        this._vcr = inject(ViewContainerRef);
        this._zone = inject(NgZone);
        this._el = inject(ElementRef);
        this._contentService = inject(BrnHoverCardContentService);
        this._focusMonitor = inject(FocusMonitor);
        this.focused$ = this._focusMonitor.monitor(this._el).pipe(map((e) => e !== null));
        this.hovered$ = merge(fromEvent(this._el.nativeElement, 'click').pipe(map(() => false)), createHoverObservable(this._el.nativeElement, this._zone, this._destroy$), this._contentService.hovered$, this.focused$).pipe(distinctUntilChanged());
        this.showing$ = this.hovered$.pipe(
        // we set the state to open here because we are about to open show the content
        tap((visible) => visible && this._contentService.setState('open')), switchMap((visible) => {
            // we are delaying based on the configure-able input
            return of(visible).pipe(delay(visible ? this.showDelay : this.hideDelay));
        }), switchMap((visible) => {
            // don't do anything when we are in the process of showing the content
            if (visible)
                return of(visible);
            // we set the state to closed here to trigger any animations for the element leaving
            this._contentService.setState('closed');
            // then delay to wait for the leaving animation to finish
            return of(visible).pipe(delay(this.animationDelay));
        }), distinctUntilChanged(), share(), takeUntil(this._destroy$));
        this.showDelay = 300;
        this.hideDelay = 500;
        this.animationDelay = 100;
        this.sideOffset = 5;
        this.align = 'bottom';
    }
    set brnHoverCardTriggerFor(value) {
        this._contentService.setContent(value, this._vcr);
    }
    ngOnInit() {
        this._contentService.setConfig({ attachTo: this._el, align: this.align, sideOffset: this.sideOffset });
        this.showing$.subscribe((isHovered) => {
            if (isHovered) {
                this._contentService.show();
            }
            else {
                this._contentService.hide();
            }
        });
    }
    ngOnDestroy() {
        this._destroy$.next();
        this._destroy$.complete();
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnHoverCardTriggerDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "17.3.5", type: BrnHoverCardTriggerDirective, isStandalone: true, selector: "[brnHoverCardTrigger]:not(ng-container),[brnHoverCardTriggerFor]:not(ng-container)", inputs: { showDelay: "showDelay", hideDelay: "hideDelay", animationDelay: "animationDelay", sideOffset: "sideOffset", align: "align", brnHoverCardTriggerFor: "brnHoverCardTriggerFor" }, exportAs: ["brnHoverCardTrigger"], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnHoverCardTriggerDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[brnHoverCardTrigger]:not(ng-container),[brnHoverCardTriggerFor]:not(ng-container)',
                    standalone: true,
                    exportAs: 'brnHoverCardTrigger',
                }]
        }], propDecorators: { showDelay: [{
                type: Input
            }], hideDelay: [{
                type: Input
            }], animationDelay: [{
                type: Input
            }], sideOffset: [{
                type: Input
            }], align: [{
                type: Input
            }], brnHoverCardTriggerFor: [{
                type: Input
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJuLWhvdmVyLWNhcmQtdHJpZ2dlci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3VpL2hvdmVyLWNhcmQvYnJhaW4vc3JjL2xpYi9icm4taG92ZXItY2FyZC10cmlnZ2VyLmRpcmVjdGl2ZS50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTs7OztHQUlHO0FBRUgsT0FBTyxFQUFFLFlBQVksRUFBRSxNQUFNLG1CQUFtQixDQUFDO0FBQ2pELE9BQU8sRUFDTixTQUFTLEVBQ1QsVUFBVSxFQUNWLEtBQUssRUFDTCxNQUFNLEVBQ04sZ0JBQWdCLEVBQ2hCLE1BQU0sR0FJTixNQUFNLGVBQWUsQ0FBQztBQUN2QixPQUFPLEVBQ04sT0FBTyxFQUNQLEtBQUssRUFDTCxvQkFBb0IsRUFDcEIsU0FBUyxFQUNULEdBQUcsRUFDSCxLQUFLLEVBQ0wsRUFBRSxFQUNGLEtBQUssRUFDTCxTQUFTLEVBQ1QsU0FBUyxFQUNULEdBQUcsR0FFSCxNQUFNLE1BQU0sQ0FBQztBQUVkLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxxQkFBcUIsRUFBRSxNQUFNLHlCQUF5QixDQUFDOztBQUVoRSxNQUFNLFVBQVUsU0FBUyxDQUFDLElBQTBDO0lBQ25FLE9BQU8sQ0FBQyxDQUFDLElBQUksSUFBSSxVQUFVLElBQUksSUFBSSxJQUFJLElBQUksQ0FBQyxRQUFRLEtBQUssSUFBSSxDQUFDLFlBQVksQ0FBQztBQUM1RSxDQUFDO0FBT0QsTUFBTSxPQUFPLDRCQUE0QjtJQUx6QztRQU1rQixjQUFTLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQztRQUNoQyxTQUFJLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDaEMsVUFBSyxHQUFHLE1BQU0sQ0FBQyxNQUFNLENBQUMsQ0FBQztRQUN2QixRQUFHLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FB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TSxDQUFDO2dCQUNQLElBQUksQ0FBQyxlQUFlLENBQUMsSUFBSSxFQUFFLENBQUM7WUFDN0IsQ0FBQztRQUNGLENBQUMsQ0FBQyxDQUFDO0lBQ0osQ0FBQztJQUVNLFdBQVc7UUFDakIsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsU0FBUyxDQUFDLFFBQVEsRUFBRSxDQUFDO0lBQzNCLENBQUM7OEdBbkVXLDRCQUE0QjtrR0FBNUIsNEJBQTRCOzsyRkFBNUIsNEJBQTRCO2tCQUx4QyxTQUFTO21CQUFDO29CQUNWLFFBQVEsRUFBRSxvRkFBb0Y7b0JBQzlGLFVBQVUsRUFBRSxJQUFJO29CQUNoQixRQUFRLEVBQUUscUJBQXFCO2lCQUMvQjs4QkFzQ08sU0FBUztzQkFEZixLQUFLO2dCQUdDLFNBQVM7c0JBRGYsS0FBSztnQkFHQyxjQUFjO3NCQURwQixLQUFLO2dCQUdDLFVBQVU7c0JBRGhCLEtBQUs7Z0JBSUMsS0FBSztzQkFEWCxLQUFLO2dCQUlGLHNCQUFzQjtzQkFEekIsS0FBSyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogV2UgYXJlIGJ1aWxkaW5nIG9uIHNob3VsZGVycyBvZiBnaWFudHMgaGVyZSBhbmQgdXNlIHRoZSBpbXBsZW1lbnRhdGlvbiBwcm92aWRlZCBieSB0aGUgaW5jcmVkaWJsZSBUYWlnYVVJXG4gKiB0ZWFtOiBodHRwczovL2dpdGh1Yi5jb20vdGFpZ2EtZmFtaWx5L3RhaWdhLXVpL2Jsb2IvbWFpbi9wcm9qZWN0cy9jb3JlL2RpcmVjdGl2ZXMvZHJvcGRvd24vZHJvcGRvd24taG92ZXIuZGlyZWN0aXZlLnRzXG4gKiBDaGVjayB0aGVtIG91dCEgR2l2ZSB0aGVtIGEgdHJ5ISBMZWF2ZSBhIHN0YXIhIFRoZWlyIHdvcmsgaXMgaW5jcmVkaWJsZSFcbiAqL1xuXG5pbXBvcnQgeyBGb2N1c01vbml0b3IgfSBmcm9tICdAYW5ndWxhci9jZGsvYTExeSc7XG5pbXBvcnQge1xuXHREaXJlY3RpdmUsXG5cdEVsZW1lbnRSZWYsXG5cdElucHV0LFxuXHROZ1pvbmUsXG5cdFZpZXdDb250YWluZXJSZWYsXG5cdGluamVjdCxcblx0dHlwZSBPbkRlc3Ryb3ksXG5cdHR5cGUgT25Jbml0LFxuXHR0eXBlIFRlbXBsYXRlUmVmLFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7XG5cdFN1YmplY3QsXG5cdGRlbGF5LFxuXHRkaXN0aW5jdFVudGlsQ2hhbmdlZCxcblx0ZnJvbUV2ZW50LFxuXHRtYXAsXG5cdG1lcmdlLFxuXHRvZixcblx0c2hhcmUsXG5cdHN3aXRjaE1hcCxcblx0dGFrZVVudGlsLFxuXHR0YXAsXG5cdHR5cGUgT2JzZXJ2YWJsZSxcbn0gZnJvbSAncnhqcyc7XG5pbXBvcnQgdHlwZSB7IEJybkhvdmVyQ2FyZENvbnRlbnREaXJlY3RpdmUgfSBmcm9tICcuL2Jybi1ob3Zlci1jYXJkLWNvbnRlbnQuZGlyZWN0aXZlJztcbmltcG9ydCB7IEJybkhvdmVyQ2FyZENvbnRlbnRTZXJ2aWNlIH0gZnJvbSAnLi9icm4taG92ZXItY2FyZC1jb250ZW50LnNlcnZpY2UnO1xuaW1wb3J0IHsgY3JlYXRlSG92ZXJPYnNlcnZhYmxlIH0gZnJvbSAnLi9jcmVhdGVIb3Zlck9ic2VydmFibGUnO1xuXG5leHBvcnQgZnVuY3Rpb24gaXNFbGVtZW50KG5vZGU/OiBFbGVtZW50IHwgRXZlbnRUYXJnZXQgfCBOb2RlIHwgbnVsbCk6IG5vZGUgaXMgRWxlbWVudCB7XG5cdHJldHVybiAhIW5vZGUgJiYgYG5vZGVUeXBlYCBpbiBub2RlICYmIG5vZGUubm9kZVR5cGUgPT09IE5vZGUuRUxFTUVOVF9OT0RFO1xufVxuXG5ARGlyZWN0aXZlKHtcblx0c2VsZWN0b3I6ICdbYnJuSG92ZXJDYXJkVHJpZ2dlcl06bm90KG5nLWNvbnRhaW5lciksW2JybkhvdmVyQ2FyZFRyaWdnZXJGb3JdOm5vdChuZy1jb250YWluZXIpJyxcblx0c3RhbmRhbG9uZTogdHJ1ZSxcblx0ZXhwb3J0QXM6ICdicm5Ib3ZlckNhcmRUcmlnZ2VyJyxcbn0pXG5leHBvcnQgY2xhc3MgQnJuSG92ZXJDYXJkVHJpZ2dlckRpcmVjdGl2ZSBpbXBsZW1lbnRzIE9uSW5pdCwgT25EZXN0cm95IHtcblx0cHJpdmF0ZSByZWFkb25seSBfZGVzdHJveSQgPSBuZXcgU3ViamVjdDx2b2lkPigpO1xuXHRwcml2YXRlIHJlYWRvbmx5IF92Y3IgPSBpbmplY3QoVmlld0NvbnRhaW5lclJlZik7XG5cdHByaXZhdGUgcmVhZG9ubHkgX3pvbmUgPSBpbmplY3QoTmdab25lKTtcblx0cHJpdmF0ZSByZWFkb25seSBfZWwgPSBpbmplY3QoRWxlbWVudFJlZik7XG5cdHByaXZhdGUgcmVhZG9ubHkgX2NvbnRlbnRTZXJ2aWNlID0gaW5qZWN0KEJybkhvdmVyQ2FyZENvbnRlbnRTZXJ2aWNlKTtcblx0cHJpdmF0ZSByZWFkb25seSBfZm9jdXNNb25pdG9yID0gaW5qZWN0KEZvY3VzTW9uaXRvcik7XG5cblx0cHVibGljIHJlYWRvbmx5IGZvY3VzZWQkOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gdGhpcy5fZm9jdXNNb25pdG9yLm1vbml0b3IodGhpcy5fZWwpLnBpcGUobWFwKChlKSA9PiBlICE9PSBudWxsKSk7XG5cblx0cHVibGljIHJlYWRvbmx5IGhvdmVyZWQkOiBPYnNlcnZhYmxlPGJvb2xlYW4+ID0gbWVyZ2UoXG5cdFx0ZnJvbUV2ZW50KHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQsICdjbGljaycpLnBpcGUobWFwKCgpID0+IGZhbHNlKSksXG5cdFx0Y3JlYXRlSG92ZXJPYnNlcnZhYmxlKHRoaXMuX2VsLm5hdGl2ZUVsZW1lbnQsIHRoaXMuX3pvbmUsIHRoaXMuX2Rlc3Ryb3kkKSxcblx0XHR0aGlzLl9jb250ZW50U2VydmljZS5ob3ZlcmVkJCxcblx0XHR0aGlzLmZvY3VzZWQkLFxuXHQpLnBpcGUoZGlzdGluY3RVbnRpbENoYW5nZWQoKSk7XG5cdHB1YmxpYyByZWFkb25seSBzaG93aW5nJDogT2JzZXJ2YWJsZTxib29sZWFuPiA9IHRoaXMuaG92ZXJlZCQucGlwZShcblx0XHQvLyB3ZSBzZXQgdGhlIHN0YXRlIHRvIG9wZW4gaGVyZSBiZWNhdXNlIHdlIGFyZSBhYm91dCB0byBvcGVuIHNob3cgdGhlIGNvbnRlbnRcblx0XHR0YXAoKHZpc2libGUpID0+IHZpc2libGUgJiYgdGhpcy5fY29udGVudFNlcnZpY2Uuc2V0U3RhdGUoJ29wZW4nKSksXG5cdFx0c3dpdGNoTWFwKCh2aXNpYmxlKSA9PiB7XG5cdFx0XHQvLyB3ZSBhcmUgZGVsYXlpbmcgYmFzZWQgb24gdGhlIGNvbmZpZ3VyZS1hYmxlIGlucHV0XG5cdFx0XHRyZXR1cm4gb2YodmlzaWJsZSkucGlwZShkZWxheSh2aXNpYmxlID8gdGhpcy5zaG93RGVsYXkgOiB0aGlzLmhpZGVEZWxheSkpO1xuXHRcdH0pLFxuXHRcdHN3aXRjaE1hcCgodmlzaWJsZSkgPT4ge1xuXHRcdFx0Ly8gZG9uJ3QgZG8gYW55dGhpbmcgd2hlbiB3ZSBhcmUgaW4gdGhlIHByb2Nlc3Mgb2Ygc2hvd2luZyB0aGUgY29udGVudFxuXHRcdFx0aWYgKHZpc2libGUpIHJldHVybiBvZih2aXNpYmxlKTtcblx0XHRcdC8vIHdlIHNldCB0aGUgc3RhdGUgdG8gY2xvc2VkIGhlcmUgdG8gdHJpZ2dlciBhbnkgYW5pbWF0aW9ucyBmb3IgdGhlIGVsZW1lbnQgbGVhdmluZ1xuXHRcdFx0dGhpcy5fY29udGVudFNlcnZpY2Uuc2V0U3RhdGUoJ2Nsb3NlZCcpO1xuXHRcdFx0Ly8gdGhlbiBkZWxheSB0byB3YWl0IGZvciB0aGUgbGVhdmluZyBhbmltYXRpb24gdG8gZmluaXNoXG5cdFx0XHRyZXR1cm4gb2YodmlzaWJsZSkucGlwZShkZWxheSh0aGlzLmFuaW1hdGlvbkRlbGF5KSk7XG5cdFx0fSksXG5cdFx0ZGlzdGluY3RVbnRpbENoYW5nZWQoKSxcblx0XHRzaGFyZSgpLFxuXHRcdHRha2VVbnRpbCh0aGlzLl9kZXN0cm95JCksXG5cdCk7XG5cblx0QElucHV0KClcblx0cHVibGljIHNob3dEZWxheSA9IDMwMDtcblx0QElucHV0KClcblx0cHVibGljIGhpZGVEZWxheSA9IDUwMDtcblx0QElucHV0KClcblx0cHVibGljIGFuaW1hdGlvbkRlbGF5ID0gMTAwO1xuXHRASW5wdXQoKVxuXHRwdWJsaWMgc2lkZU9mZnNldCA9IDU7XG5cblx0QElucHV0KClcblx0cHVibGljIGFsaWduOiAndG9wJyB8ICdib3R0b20nID0gJ2JvdHRvbSc7XG5cblx0QElucHV0KClcblx0c2V0IGJybkhvdmVyQ2FyZFRyaWdnZXJGb3IodmFsdWU6IFRlbXBsYXRlUmVmPHVua25vd24+IHwgQnJuSG92ZXJDYXJkQ29udGVudERpcmVjdGl2ZSkge1xuXHRcdHRoaXMuX2NvbnRlbnRTZXJ2aWNlLnNldENvbnRlbnQodmFsdWUsIHRoaXMuX3Zjcik7XG5cdH1cblxuXHRwdWJsaWMgbmdPbkluaXQoKSB7XG5cdFx0dGhpcy5fY29udGVudFNlcnZpY2Uuc2V0Q29uZmlnKHsgYXR0YWNoVG86IHRoaXMuX2VsLCBhbGlnbjogdGhpcy5hbGlnbiwgc2lkZU9mZnNldDogdGhpcy5zaWRlT2Zmc2V0IH0pO1xuXHRcdHRoaXMuc2hvd2luZyQuc3Vic2NyaWJlKChpc0hvdmVyZWQpID0+IHtcblx0XHRcdGlmIChpc0hvdmVyZWQpIHtcblx0XHRcdFx0dGhpcy5fY29udGVudFNlcnZpY2Uuc2hvdygpO1xuXHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0dGhpcy5fY29udGVudFNlcnZpY2UuaGlkZSgpO1xuXHRcdFx0fVxuXHRcdH0pO1xuXHR9XG5cblx0cHVibGljIG5nT25EZXN0cm95KCkge1xuXHRcdHRoaXMuX2Rlc3Ryb3kkLm5leHQoKTtcblx0XHR0aGlzLl9kZXN0cm95JC5jb21wbGV0ZSgpO1xuXHR9XG59XG4iXX0=