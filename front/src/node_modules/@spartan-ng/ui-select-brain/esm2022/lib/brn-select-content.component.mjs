import { CdkListbox } from '@angular/cdk/listbox';
import { NgTemplateOutlet } from '@angular/common';
import { ChangeDetectionStrategy, Component, ContentChild, ContentChildren, DestroyRef, ElementRef, ViewChild, effect, inject, signal, } from '@angular/core';
import { takeUntilDestroyed, toObservable } from '@angular/core/rxjs-interop';
import { BrnSelectOptionDirective } from './brn-select-option.directive';
import { BrnSelectScrollDownDirective } from './brn-select-scroll-down.directive';
import { BrnSelectScrollUpDirective } from './brn-select-scroll-up.directive';
import { BrnSelectService } from './brn-select.service';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/listbox";
export class BrnSelectContentComponent {
    constructor() {
        this._el = inject(ElementRef);
        this._cdkListbox = inject(CdkListbox, { host: true });
        this.destroyRef = inject(DestroyRef);
        this._selectService = inject(BrnSelectService);
        this.labelledBy = this._selectService.labelId;
        this.id = this._selectService.id;
        this.canScrollUp = signal(false);
        this.canScrollDown = signal(false);
        this.initialSelectedOptions$ = toObservable(this._selectService.initialSelectedOptions);
        this._cdkListbox.valueChange
            .asObservable()
            .pipe(takeUntilDestroyed())
            .subscribe((val) => this._selectService.listBoxValueChangeEvent$.next(val));
        effect(() => {
            this._cdkListbox.multiple = this._selectService.multiple();
            this._selectService.isExpanded() && setTimeout(() => this.updateArrowDisplay());
        });
    }
    ngAfterViewInit() {
        this.setInitiallySelectedOptions();
    }
    setInitiallySelectedOptions() {
        this.initialSelectedOptions$.pipe(takeUntilDestroyed(this.destroyRef)).subscribe((selectedOptions) => {
            // Reapplying cdkLibstbox multiple because seems this is running before effect that
            // updates cdklistbox, reapplying multiple true so we can set the multiple initial options
            if (this._selectService.multiple()) {
                this._cdkListbox.multiple = true;
            }
            this._selectService.possibleOptions().forEach((cdkOption) => {
                if (selectedOptions.includes(cdkOption)) {
                    cdkOption?.select();
                }
                else {
                    cdkOption?.deselect();
                }
            });
            selectedOptions.forEach((cdkOption) => cdkOption?.select());
        });
    }
    updateArrowDisplay() {
        this.canScrollUp.set(this.viewport.nativeElement.scrollTop > 0);
        const maxScroll = this.viewport.nativeElement.scrollHeight - this.viewport.nativeElement.clientHeight;
        this.canScrollDown.set(Math.ceil(this.viewport.nativeElement.scrollTop) < maxScroll);
    }
    handleScroll() {
        this.updateArrowDisplay();
    }
    focusList() {
        this._cdkListbox.focus();
    }
    moveFocusUp() {
        this.viewport.nativeElement.scrollBy({ top: -100, behavior: 'smooth' });
        if (this.viewport.nativeElement.scrollTop === 0) {
            this.scrollUpBtn.stopEmittingEvents();
        }
    }
    moveFocusDown() {
        this.viewport.nativeElement.scrollBy({ top: 100, behavior: 'smooth' });
        const viewportSize = this._el.nativeElement.scrollHeight;
        const viewportScrollPosition = this.viewport.nativeElement.scrollTop;
        if (viewportSize + viewportScrollPosition + 100 > this.viewport.nativeElement.scrollHeight + 50) {
            this.scrollDownBtn.stopEmittingEvents();
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnSelectContentComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "14.0.0", version: "17.3.5", type: BrnSelectContentComponent, isStandalone: true, selector: "brn-select-content, hlm-select-content:not(noHlm)", host: { properties: { "attr.aria-labelledBy": "labelledBy()", "attr.aria-controlledBy": "id() +'--trigger'", "id": "id() + '--content'", "attr.dir": "_selectService.dir()" } }, queries: [{ propertyName: "scrollUpBtn", first: true, predicate: BrnSelectScrollUpDirective, descendants: true }, { propertyName: "scrollDownBtn", first: true, predicate: BrnSelectScrollDownDirective, descendants: true }, { propertyName: "_options", predicate: BrnSelectOptionDirective, descendants: true }], viewQueries: [{ propertyName: "viewport", first: true, predicate: ["viewport"], descendants: true }], hostDirectives: [{ directive: i1.CdkListbox }], ngImport: i0, template: `
		<ng-template #scrollUp>
			<ng-content select="hlm-select-scroll-up" />
			<ng-content select="brnSelectScrollUp" />
		</ng-template>
		<ng-container *ngTemplateOutlet="canScrollUp() && scrollUpBtn ? scrollUp : null" />
		<div
			data-brn-select-viewport
			#viewport
			(scroll)="handleScroll()"
			style="flex: 1 1 0%;
			position: relative;
			width:100%;
			overflow:auto;
			min-height: 36px;
      padding-bottom: 2px;
      margin-bottom: -2px;"
		>
			<ng-content />
		</div>
		<ng-template #scrollDown>
			<ng-content select="brnSelectScrollDown" />
			<ng-content select="hlm-select-scroll-down" />
		</ng-template>
		<ng-container *ngTemplateOutlet="canScrollDown() && scrollDownBtn ? scrollDown : null" />
	`, isInline: true, styles: [":host{display:flex;box-sizing:border-box;flex-direction:column;outline:none;pointer-events:auto}[data-brn-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch}[data-brn-select-viewport]::-webkit-scrollbar{display:none}\n"], dependencies: [{ kind: "directive", type: NgTemplateOutlet, selector: "[ngTemplateOutlet]", inputs: ["ngTemplateOutletContext", "ngTemplateOutlet", "ngTemplateOutletInjector"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnSelectContentComponent, decorators: [{
            type: Component,
            args: [{ selector: 'brn-select-content, hlm-select-content:not(noHlm)', standalone: true, imports: [BrnSelectScrollUpDirective, BrnSelectScrollDownDirective, NgTemplateOutlet], hostDirectives: [CdkListbox], changeDetection: ChangeDetectionStrategy.OnPush, host: {
                        '[attr.aria-labelledBy]': 'labelledBy()',
                        '[attr.aria-controlledBy]': "id() +'--trigger'",
                        '[id]': "id() + '--content'",
                        '[attr.dir]': '_selectService.dir()',
                    }, template: `
		<ng-template #scrollUp>
			<ng-content select="hlm-select-scroll-up" />
			<ng-content select="brnSelectScrollUp" />
		</ng-template>
		<ng-container *ngTemplateOutlet="canScrollUp() && scrollUpBtn ? scrollUp : null" />
		<div
			data-brn-select-viewport
			#viewport
			(scroll)="handleScroll()"
			style="flex: 1 1 0%;
			position: relative;
			width:100%;
			overflow:auto;
			min-height: 36px;
      padding-bottom: 2px;
      margin-bottom: -2px;"
		>
			<ng-content />
		</div>
		<ng-template #scrollDown>
			<ng-content select="brnSelectScrollDown" />
			<ng-content select="hlm-select-scroll-down" />
		</ng-template>
		<ng-container *ngTemplateOutlet="canScrollDown() && scrollDownBtn ? scrollDown : null" />
	`, styles: [":host{display:flex;box-sizing:border-box;flex-direction:column;outline:none;pointer-events:auto}[data-brn-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch}[data-brn-select-viewport]::-webkit-scrollbar{display:none}\n"] }]
        }], ctorParameters: () => [], propDecorators: { viewport: [{
                type: ViewChild,
                args: ['viewport']
            }], scrollUpBtn: [{
                type: ContentChild,
                args: [BrnSelectScrollUpDirective, { static: false }]
            }], scrollDownBtn: [{
                type: ContentChild,
                args: [BrnSelectScrollDownDirective, { static: false }]
            }], _options: [{
                type: ContentChildren,
                args: [BrnSelectOptionDirective, { descendants: true }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJuLXNlbGVjdC1jb250ZW50LmNvbXBvbmVudC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uLy4uLy4uLy4uLy4uL2xpYnMvdWkvc2VsZWN0L2JyYWluL3NyYy9saWIvYnJuLXNlbGVjdC1jb250ZW50LmNvbXBvbmVudC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQUUsVUFBVSxFQUFnQyxNQUFNLHNCQUFzQixDQUFDO0FBQ2hGLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLGlCQUFpQixDQUFDO0FBQ25ELE9BQU8sRUFDTix1QkFBdUIsRUFDdkIsU0FBUyxFQUNULFlBQVksRUFDWixlQUFlLEVBQ2YsVUFBVSxFQUNWLFVBQVUsRUFDVixTQUFTLEVBQ1QsTUFBTSxFQUNOLE1BQU0sRUFDTixNQUFNLEdBR04sTUFBTSxlQUFlLENBQUM7QUFDdkIsT0FBTyxFQUFFLGtCQUFrQixFQUFFLFlBQVksRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQzlFLE9BQU8sRUFBRSx3QkFBd0IsRUFBRSxNQUFNLCtCQUErQixDQUFDO0FBQ3pFLE9BQU8sRUFBRSw0QkFBNEIsRUFBRSxNQUFNLG9DQUFvQyxDQUFDO0FBQ2xGLE9BQU8sRUFBRSwwQkFBMEIsRUFBRSxNQUFNLGtDQUFrQyxDQUFDO0FBQzlFLE9BQU8sRUFBRSxnQkFBZ0IsRUFBRSxNQUFNLHNCQUFzQixDQUFDOzs7QUE4RHhELE1BQU0sT0FBTyx5QkFBeUI7SUF5QnJDO1FBeEJpQixRQUFHLEdBQTRCLE1BQU0sQ0FBQyxVQUFVLENBQUMsQ0FBQztRQUNsRCxnQkFBVyxHQUFHLE1BQU0sQ0FBQyxVQUFVLEVBQUUsRUFBRSxJQUFJLEVBQUUsSUFBSSxFQUFFLENBQUMsQ0FBQztRQUNqRCxlQUFVLEdBQUcsTUFBTSxDQUFDLFVBQVUsQ0FBQyxDQUFDO1FBQzlCLG1CQUFjLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFFMUMsZUFBVSxHQUFHLElBQUks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O3dCQUMvQyxNQUFNLEVBQUUsb0JBQW9CO3dCQUM1QixZQUFZLEVBQUUsc0JBQXNCO3FCQUNwQyxZQXNCUzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztFQXlCVDt3REFnQlMsUUFBUTtzQkFEakIsU0FBUzt1QkFBQyxVQUFVO2dCQUlYLFdBQVc7c0JBRHBCLFlBQVk7dUJBQUMsMEJBQTBCLEVBQUUsRUFBRSxNQUFNLEVBQUUsS0FBSyxFQUFFO2dCQUlqRCxhQUFhO3NCQUR0QixZQUFZO3VCQUFDLDRCQUE0QixFQUFFLEVBQUUsTUFBTSxFQUFFLEtBQUssRUFBRTtnQkFJbkQsUUFBUTtzQkFEakIsZUFBZTt1QkFBQyx3QkFBd0IsRUFBRSxFQUFFLFdBQVcsRUFBRSxJQUFJLEVBQUUiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBDZGtMaXN0Ym94LCB0eXBlIExpc3Rib3hWYWx1ZUNoYW5nZUV2ZW50IH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2xpc3Rib3gnO1xuaW1wb3J0IHsgTmdUZW1wbGF0ZU91dGxldCB9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XG5pbXBvcnQge1xuXHRDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneSxcblx0Q29tcG9uZW50LFxuXHRDb250ZW50Q2hpbGQsXG5cdENvbnRlbnRDaGlsZHJlbixcblx0RGVzdHJveVJlZixcblx0RWxlbWVudFJlZixcblx0Vmlld0NoaWxkLFxuXHRlZmZlY3QsXG5cdGluamVjdCxcblx0c2lnbmFsLFxuXHR0eXBlIEFmdGVyVmlld0luaXQsXG5cdHR5cGUgUXVlcnlMaXN0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IHRha2VVbnRpbERlc3Ryb3llZCwgdG9PYnNlcnZhYmxlIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuaW1wb3J0IHsgQnJuU2VsZWN0T3B0aW9uRGlyZWN0aXZlIH0gZnJvbSAnLi9icm4tc2VsZWN0LW9wdGlvbi5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQnJuU2VsZWN0U2Nyb2xsRG93bkRpcmVjdGl2ZSB9IGZyb20gJy4vYnJuLXNlbGVjdC1zY3JvbGwtZG93bi5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgQnJuU2VsZWN0U2Nyb2xsVXBEaXJlY3RpdmUgfSBmcm9tICcuL2Jybi1zZWxlY3Qtc2Nyb2xsLXVwLmRpcmVjdGl2ZSc7XG5pbXBvcnQgeyBCcm5TZWxlY3RTZXJ2aWNlIH0gZnJvbSAnLi9icm4tc2VsZWN0LnNlcnZpY2UnO1xuXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdicm4tc2VsZWN0LWNvbnRlbnQsIGhsbS1zZWxlY3QtY29udGVudDpub3Qobm9IbG0pJyxcblx0c3RhbmRhbG9uZTogdHJ1ZSxcblx0aW1wb3J0czogW0JyblNlbGVjdFNjcm9sbFVwRGlyZWN0aXZlLCBCcm5TZWxlY3RTY3JvbGxEb3duRGlyZWN0aXZlLCBOZ1RlbXBsYXRlT3V0bGV0XSxcblx0aG9zdERpcmVjdGl2ZXM6IFtDZGtMaXN0Ym94XSxcblx0Y2hhbmdlRGV0ZWN0aW9uOiBDaGFuZ2VEZXRlY3Rpb25TdHJhdGVneS5PblB1c2gsXG5cdGhvc3Q6IHtcblx0XHQnW2F0dHIuYXJpYS1sYWJlbGxlZEJ5XSc6ICdsYWJlbGxlZEJ5KCknLFxuXHRcdCdbYXR0ci5hcmlhLWNvbnRyb2xsZWRCeV0nOiBcImlkKCkgKyctLXRyaWdnZXInXCIsXG5cdFx0J1tpZF0nOiBcImlkKCkgKyAnLS1jb250ZW50J1wiLFxuXHRcdCdbYXR0ci5kaXJdJzogJ19zZWxlY3RTZXJ2aWNlLmRpcigpJyxcblx0fSxcblx0c3R5bGVzOiBbXG5cdFx0YFxuXHRcdFx0Omhvc3Qge1xuXHRcdFx0XHRkaXNwbGF5OiBmbGV4O1xuXHRcdFx0XHRib3gtc2l6aW5nOiBib3JkZXItYm94O1xuXHRcdFx0XHRmbGV4LWRpcmVjdGlvbjogY29sdW1uO1xuXHRcdFx0XHRvdXRsaW5lOiBub25lO1xuXHRcdFx0XHRwb2ludGVyLWV2ZW50czogYXV0bztcblx0XHRcdH1cblxuXHRcdFx0W2RhdGEtYnJuLXNlbGVjdC12aWV3cG9ydF0ge1xuXHRcdFx0XHRzY3JvbGxiYXItd2lkdGg6IG5vbmU7XG5cdFx0XHRcdC1tcy1vdmVyZmxvdy1zdHlsZTogbm9uZTtcblx0XHRcdFx0LXdlYmtpdC1vdmVyZmxvdy1zY3JvbGxpbmc6IHRvdWNoO1xuXHRcdFx0fVxuXG5cdFx0XHRbZGF0YS1icm4tc2VsZWN0LXZpZXdwb3J0XTo6LXdlYmtpdC1zY3JvbGxiYXIge1xuXHRcdFx0XHRkaXNwbGF5OiBub25lO1xuXHRcdFx0fVxuXHRcdGAsXG5cdF0sXG5cdHRlbXBsYXRlOiBgXG5cdFx0PG5nLXRlbXBsYXRlICNzY3JvbGxVcD5cblx0XHRcdDxuZy1jb250ZW50IHNlbGVjdD1cImhsbS1zZWxlY3Qtc2Nyb2xsLXVwXCIgLz5cblx0XHRcdDxuZy1jb250ZW50IHNlbGVjdD1cImJyblNlbGVjdFNjcm9sbFVwXCIgLz5cblx0XHQ8L25nLXRlbXBsYXRlPlxuXHRcdDxuZy1jb250YWluZXIgKm5nVGVtcGxhdGVPdXRsZXQ9XCJjYW5TY3JvbGxVcCgpICYmIHNjcm9sbFVwQnRuID8gc2Nyb2xsVXAgOiBudWxsXCIgLz5cblx0XHQ8ZGl2XG5cdFx0XHRkYXRhLWJybi1zZWxlY3Qtdmlld3BvcnRcblx0XHRcdCN2aWV3cG9ydFxuXHRcdFx0KHNjcm9sbCk9XCJoYW5kbGVTY3JvbGwoKVwiXG5cdFx0XHRzdHlsZT1cImZsZXg6IDEgMSAwJTtcblx0XHRcdHBvc2l0aW9uOiByZWxhdGl2ZTtcblx0XHRcdHdpZHRoOjEwMCU7XG5cdFx0XHRvdmVyZmxvdzphdXRvO1xuXHRcdFx0bWluLWhlaWdodDogMzZweDtcbiAgICAgIHBhZGRpbmctYm90dG9tOiAycHg7XG4gICAgICBtYXJnaW4tYm90dG9tOiAtMnB4O1wiXG5cdFx0PlxuXHRcdFx0PG5nLWNvbnRlbnQgLz5cblx0XHQ8L2Rpdj5cblx0XHQ8bmctdGVtcGxhdGUgI3Njcm9sbERvd24+XG5cdFx0XHQ8bmctY29udGVudCBzZWxlY3Q9XCJicm5TZWxlY3RTY3JvbGxEb3duXCIgLz5cblx0XHRcdDxuZy1jb250ZW50IHNlbGVjdD1cImhsbS1zZWxlY3Qtc2Nyb2xsLWRvd25cIiAvPlxuXHRcdDwvbmctdGVtcGxhdGU+XG5cdFx0PG5nLWNvbnRhaW5lciAqbmdUZW1wbGF0ZU91dGxldD1cImNhblNjcm9sbERvd24oKSAmJiBzY3JvbGxEb3duQnRuID8gc2Nyb2xsRG93biA6IG51bGxcIiAvPlxuXHRgLFxufSlcbmV4cG9ydCBjbGFzcyBCcm5TZWxlY3RDb250ZW50Q29tcG9uZW50IGltcGxlbWVudHMgQWZ0ZXJWaWV3SW5pdCB7XG5cdHByaXZhdGUgcmVhZG9ubHkgX2VsOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PiA9IGluamVjdChFbGVtZW50UmVmKTtcblx0cHJpdmF0ZSByZWFkb25seSBfY2RrTGlzdGJveCA9IGluamVjdChDZGtMaXN0Ym94LCB7IGhvc3Q6IHRydWUgfSk7XG5cdHByaXZhdGUgcmVhZG9ubHkgZGVzdHJveVJlZiA9IGluamVjdChEZXN0cm95UmVmKTtcblx0cHJvdGVjdGVkIHJlYWRvbmx5IF9zZWxlY3RTZXJ2aWNlID0gaW5qZWN0KEJyblNlbGVjdFNlcnZpY2UpO1xuXG5cdHByb3RlY3RlZCByZWFkb25seSBsYWJlbGxlZEJ5ID0gdGhpcy5fc2VsZWN0U2VydmljZS5sYWJlbElkO1xuXHRwcm90ZWN0ZWQgcmVhZG9ubHkgaWQgPSB0aGlzLl9zZWxlY3RTZXJ2aWNlLmlkO1xuXHRwcm90ZWN0ZWQgcmVhZG9ubHkgY2FuU2Nyb2xsVXAgPSBzaWduYWwoZmFsc2UpO1xuXHRwcm90ZWN0ZWQgcmVhZG9ubHkgY2FuU2Nyb2xsRG93biA9IHNpZ25hbChmYWxzZSk7XG5cblx0cHJvdGVjdGVkIGluaXRpYWxTZWxlY3RlZE9wdGlvbnMkID0gdG9PYnNlcnZhYmxlKHRoaXMuX3NlbGVjdFNlcnZpY2UuaW5pdGlhbFNlbGVjdGVkT3B0aW9ucyk7XG5cblx0QFZpZXdDaGlsZCgndmlld3BvcnQnKVxuXHRwcm90ZWN0ZWQgdmlld3BvcnQhOiBFbGVtZW50UmVmPEhUTUxFbGVtZW50PjtcblxuXHRAQ29udGVudENoaWxkKEJyblNlbGVjdFNjcm9sbFVwRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSlcblx0cHJvdGVjdGVkIHNjcm9sbFVwQnRuITogQnJuU2VsZWN0U2Nyb2xsVXBEaXJlY3RpdmU7XG5cblx0QENvbnRlbnRDaGlsZChCcm5TZWxlY3RTY3JvbGxEb3duRGlyZWN0aXZlLCB7IHN0YXRpYzogZmFsc2UgfSlcblx0cHJvdGVjdGVkIHNjcm9sbERvd25CdG4hOiBCcm5TZWxlY3RTY3JvbGxEb3duRGlyZWN0aXZlO1xuXG5cdEBDb250ZW50Q2hpbGRyZW4oQnJuU2VsZWN0T3B0aW9uRGlyZWN0aXZlLCB7IGRlc2NlbmRhbnRzOiB0cnVlIH0pXG5cdHByb3RlY3RlZCBfb3B0aW9ucyE6IFF1ZXJ5TGlzdDxCcm5TZWxlY3RPcHRpb25EaXJlY3RpdmU+O1xuXG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdHRoaXMuX2Nka0xpc3Rib3gudmFsdWVDaGFuZ2Vcblx0XHRcdC5hc09ic2VydmFibGUoKVxuXHRcdFx0LnBpcGUodGFrZVVudGlsRGVzdHJveWVkKCkpXG5cdFx0XHQuc3Vic2NyaWJlKCh2YWw6IExpc3Rib3hWYWx1ZUNoYW5nZUV2ZW50PHVua25vd24+KSA9PiB0aGlzLl9zZWxlY3RTZXJ2aWNlLmxpc3RCb3hWYWx1ZUNoYW5nZUV2ZW50JC5uZXh0KHZhbCkpO1xuXG5cdFx0ZWZmZWN0KCgpID0+IHtcblx0XHRcdHRoaXMuX2Nka0xpc3Rib3gubXVsdGlwbGUgPSB0aGlzLl9zZWxlY3RTZXJ2aWNlLm11bHRpcGxlKCk7XG5cdFx0XHR0aGlzLl9zZWxlY3RTZXJ2aWNlLmlzRXhwYW5kZWQoKSAmJiBzZXRUaW1lb3V0KCgpID0+IHRoaXMudXBkYXRlQXJyb3dEaXNwbGF5KCkpO1xuXHRcdH0pO1xuXHR9XG5cblx0bmdBZnRlclZpZXdJbml0KCk6IHZvaWQge1xuXHRcdHRoaXMuc2V0SW5pdGlhbGx5U2VsZWN0ZWRPcHRpb25zKCk7XG5cdH1cblxuXHRwcml2YXRlIHNldEluaXRpYWxseVNlbGVjdGVkT3B0aW9ucygpIHtcblx0XHR0aGlzLmluaXRpYWxTZWxlY3RlZE9wdGlvbnMkLnBpcGUodGFrZVVudGlsRGVzdHJveWVkKHRoaXMuZGVzdHJveVJlZikpLnN1YnNjcmliZSgoc2VsZWN0ZWRPcHRpb25zKSA9PiB7XG5cdFx0XHQvLyBSZWFwcGx5aW5nIGNka0xpYnN0Ym94IG11bHRpcGxlIGJlY2F1c2Ugc2VlbXMgdGhpcyBpcyBydW5uaW5nIGJlZm9yZSBlZmZlY3QgdGhhdFxuXHRcdFx0Ly8gdXBkYXRlcyBjZGtsaXN0Ym94LCByZWFwcGx5aW5nIG11bHRpcGxlIHRydWUgc28gd2UgY2FuIHNldCB0aGUgbXVsdGlwbGUgaW5pdGlhbCBvcHRpb25zXG5cdFx0XHRpZiAodGhpcy5fc2VsZWN0U2VydmljZS5tdWx0aXBsZSgpKSB7XG5cdFx0XHRcdHRoaXMuX2Nka0xpc3Rib3gubXVsdGlwbGUgPSB0cnVlO1xuXHRcdFx0fVxuXG5cdFx0XHR0aGlzLl9zZWxlY3RTZXJ2aWNlLnBvc3NpYmxlT3B0aW9ucygpLmZvckVhY2goKGNka09wdGlvbikgPT4ge1xuXHRcdFx0XHRpZiAoc2VsZWN0ZWRPcHRpb25zLmluY2x1ZGVzKGNka09wdGlvbikpIHtcblx0XHRcdFx0XHRjZGtPcHRpb24/LnNlbGVjdCgpO1xuXHRcdFx0XHR9IGVsc2Uge1xuXHRcdFx0XHRcdGNka09wdGlvbj8uZGVzZWxlY3QoKTtcblx0XHRcdFx0fVxuXHRcdFx0fSk7XG5cdFx0XHRzZWxlY3RlZE9wdGlvbnMuZm9yRWFjaCgoY2RrT3B0aW9uKSA9PiBjZGtPcHRpb24/LnNlbGVjdCgpKTtcblx0XHR9KTtcblx0fVxuXG5cdHB1YmxpYyB1cGRhdGVBcnJvd0Rpc3BsYXkoKTogdm9pZCB7XG5cdFx0dGhpcy5jYW5TY3JvbGxVcC5zZXQodGhpcy52aWV3cG9ydC5uYXRpdmVFbGVtZW50LnNjcm9sbFRvcCA+IDApO1xuXHRcdGNvbnN0IG1heFNjcm9sbCA9IHRoaXMudmlld3BvcnQubmF0aXZlRWxlbWVudC5zY3JvbGxIZWlnaHQgLSB0aGlzLnZpZXdwb3J0Lm5hdGl2ZUVsZW1lbnQuY2xpZW50SGVpZ2h0O1xuXHRcdHRoaXMuY2FuU2Nyb2xsRG93bi5zZXQoTWF0aC5jZWlsKHRoaXMudmlld3BvcnQubmF0aXZlRWxlbWVudC5zY3JvbGxUb3ApIDwgbWF4U2Nyb2xsKTtcblx0fVxuXG5cdHB1YmxpYyBoYW5kbGVTY3JvbGwoKSB7XG5cdFx0dGhpcy51cGRhdGVBcnJvd0Rpc3BsYXkoKTtcblx0fVxuXG5cdHB1YmxpYyBmb2N1c0xpc3QoKTogdm9pZCB7XG5cdFx0dGhpcy5fY2RrTGlzdGJveC5mb2N1cygpO1xuXHR9XG5cblx0cHVibGljIG1vdmVGb2N1c1VwKCkge1xuXHRcdHRoaXMudmlld3BvcnQubmF0aXZlRWxlbWVudC5zY3JvbGxCeSh7IHRvcDogLTEwMCwgYmVoYXZpb3I6ICdzbW9vdGgnIH0pO1xuXHRcdGlmICh0aGlzLnZpZXdwb3J0Lm5hdGl2ZUVsZW1lbnQuc2Nyb2xsVG9wID09PSAwKSB7XG5cdFx0XHR0aGlzLnNjcm9sbFVwQnRuLnN0b3BFbWl0dGluZ0V2ZW50cygpO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyBtb3ZlRm9jdXNEb3duKCkge1xuXHRcdHRoaXMudmlld3BvcnQubmF0aXZlRWxlbWVudC5zY3JvbGxCeSh7IHRvcDogMTAwLCBiZWhhdmlvcjogJ3Ntb290aCcgfSk7XG5cdFx0Y29uc3Qgdmlld3BvcnRTaXplID0gdGhpcy5fZWwubmF0aXZlRWxlbWVudC5zY3JvbGxIZWlnaHQ7XG5cdFx0Y29uc3Qgdmlld3BvcnRTY3JvbGxQb3NpdGlvbiA9IHRoaXMudmlld3BvcnQubmF0aXZlRWxlbWVudC5zY3JvbGxUb3A7XG5cdFx0aWYgKHZpZXdwb3J0U2l6ZSArIHZpZXdwb3J0U2Nyb2xsUG9zaXRpb24gKyAxMDAgPiB0aGlzLnZpZXdwb3J0Lm5hdGl2ZUVsZW1lbnQuc2Nyb2xsSGVpZ2h0ICsgNTApIHtcblx0XHRcdHRoaXMuc2Nyb2xsRG93bkJ0bi5zdG9wRW1pdHRpbmdFdmVudHMoKTtcblx0XHR9XG5cdH1cbn1cbiJdfQ==