import { Directive, Input, TemplateRef, ViewContainerRef, computed, effect, inject, numberAttribute, signal, } from '@angular/core';
import * as i0 from "@angular/core";
export class BrnPaginatorDirective {
    static ngTemplateContextGuard(directive, context) {
        return true;
    }
    set totalElements(value) {
        this.calculateNewState({ newTotalElements: value, newPage: 0 });
    }
    set currentPage(value) {
        this.calculateNewState({ newPage: value });
    }
    set pageSize(value) {
        this.calculateNewState({ newPageSize: value, newPage: 0 });
    }
    constructor() {
        this._vcr = inject(ViewContainerRef);
        this._template = inject((TemplateRef));
        this._state = signal({
            currentPage: 0,
            startIndex: 0,
            endIndex: 0,
            pageSize: 10,
            totalPages: 0,
            totalElements: null,
        });
        this._decrementable = computed(() => 0 < this._state().startIndex);
        this._incrementable = computed(() => this._state().endIndex < (this._state().totalElements ?? 0) - 1);
        effect(() => {
            const state = this._state();
            Promise.resolve().then(() => {
                if (this.onStateChange) {
                    this.onStateChange(state);
                }
            });
        }, { allowSignalWrites: true });
    }
    ngOnInit() {
        this._vcr.createEmbeddedView(this._template, {
            $implicit: {
                state: this._state,
                increment: () => this.incrementPage(),
                decrement: () => this.decrementPage(),
                incrementable: this._incrementable,
                decrementable: this._decrementable,
            },
        });
    }
    decrementPage() {
        const { currentPage } = this._state();
        if (0 < currentPage) {
            this.calculateNewState({ newPage: currentPage - 1 });
        }
    }
    incrementPage() {
        const { currentPage, totalPages } = this._state();
        if (totalPages > currentPage) {
            this.calculateNewState({ newPage: currentPage + 1 });
        }
    }
    reset() {
        this.currentPage = 0;
    }
    calculateNewState({ newPage, newPageSize, newTotalElements, }) {
        const previousState = this._state();
        let currentPage = newPage ?? previousState.currentPage;
        const pageSize = newPageSize ?? previousState.pageSize;
        const totalElements = newTotalElements ?? previousState.totalElements ?? 0;
        const newTotalPages = totalElements ? Math.floor(totalElements / pageSize) : 0;
        if (newTotalPages < currentPage - 1) {
            currentPage = newTotalPages - 1;
        }
        const newStartIndex = totalElements === 0 ? 0 : Math.min(totalElements - 1, currentPage * pageSize);
        const newEndIndex = Math.min((currentPage + 1) * pageSize - 1, totalElements - 1);
        const newState = {
            currentPage: currentPage,
            startIndex: newStartIndex,
            endIndex: newEndIndex,
            pageSize: pageSize,
            totalPages: newTotalPages,
            totalElements: totalElements,
        };
        this._state.set(newState);
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnPaginatorDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive }); }
    static { this.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "16.1.0", version: "17.3.5", type: BrnPaginatorDirective, isStandalone: true, selector: "[brnPaginator]", inputs: { totalElements: ["brnPaginatorTotalElements", "totalElements"], currentPage: ["brnPaginatorCurrentPage", "currentPage", numberAttribute], pageSize: ["brnPaginatorPageSize", "pageSize", numberAttribute], onStateChange: ["brnPaginatorOnStateChange", "onStateChange"] }, exportAs: ["brnPaginator"], ngImport: i0 }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnPaginatorDirective, decorators: [{
            type: Directive,
            args: [{
                    standalone: true,
                    selector: '[brnPaginator]',
                    exportAs: 'brnPaginator',
                }]
        }], ctorParameters: () => [], propDecorators: { totalElements: [{
                type: Input,
                args: [{ alias: 'brnPaginatorTotalElements' }]
            }], currentPage: [{
                type: Input,
                args: [{ alias: 'brnPaginatorCurrentPage', transform: numberAttribute }]
            }], pageSize: [{
                type: Input,
                args: [{ alias: 'brnPaginatorPageSize', transform: numberAttribute }]
            }], onStateChange: [{
                type: Input,
                args: [{ alias: 'brnPaginatorOnStateChange' }]
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJuLXBhZ2luYXRvci5kaXJlY3RpdmUuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3VpL3RhYmxlL2JyYWluL3NyYy9saWIvYnJuLXBhZ2luYXRvci5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUNOLFNBQVMsRUFDVCxLQUFLLEVBQ0wsV0FBVyxFQUNYLGdCQUFnQixFQUNoQixRQUFRLEVBQ1IsTUFBTSxFQUNOLE1BQU0sRUFDTixlQUFlLEVBQ2YsTUFBTSxHQUdOLE1BQU0sZUFBZSxDQUFDOztBQTBCdkIsTUFBTSxPQUFPLHFCQUFxQjtJQUNqQyxNQUFNLENBQUMsc0JBQXNCLENBQUMsU0FBZ0MsRUFBRSxPQUFnQjtRQUMvRSxPQUFPLElBQUksQ0FBQztJQUNiLENBQUM7SUFnQkQsSUFDSSxhQUFhLENBQUMsS0FBZ0M7UUFDakQsSUFBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsZ0JBQWdCLEVBQUUsS0FBSyxFQUFFLE9BQU8sRUFBRSxDQUFDLEVBQUUsQ0FBQyxDQUFDO0lBQ2pFLENBQUM7SUFFRCxJQUNJLFdBQVcsQ0FBQyxLQUFhO1FBQzVCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLE9BQU8sRUFBRSxLQUFLLEVBQUUsQ0FBQyxDQUFDO0lBQzVDLENBQUM7SUFFRCxJQUNJLFFBQVEsQ0FBQyxLQUFhO1FBQ3pCLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFdBQVcsRUFBRSxLQUFLLEVBQUUsT0FBTyxFQUFFLENBQUMsRUFBRSxDQUFDLENBQUM7SUFDNUQsQ0FBQztJQU1EO1FBakNpQixTQUFJLEdBQUcsTUFBTSxDQUFDLGdCQUFnQixDQUFDLENBQUM7UUFDaEMsY0FBUyxHQUFHLE1BQU0sQ0FBQyxDQUFBLFdBQW9CLENBQUEsQ0FBQyxDQUFDO1FBRXpDLFdBQU0sR0FBRyxNQUFNLENBQWlCO1lBQ2hELFdBQVcsRUFBRSxDQUFDO1lBQ2QsVUFB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QUFTLEVBQUUsZUFBZSxFQUFFO2dCQU83RCxhQUFhO3NCQUZuQixLQUFLO3VCQUFDLEVBQUUsS0FBSyxFQUFFLDJCQUEyQixFQUFFIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcblx0RGlyZWN0aXZlLFxuXHRJbnB1dCxcblx0VGVtcGxhdGVSZWYsXG5cdFZpZXdDb250YWluZXJSZWYsXG5cdGNvbXB1dGVkLFxuXHRlZmZlY3QsXG5cdGluamVjdCxcblx0bnVtYmVyQXR0cmlidXRlLFxuXHRzaWduYWwsXG5cdHR5cGUgT25Jbml0LFxuXHR0eXBlIFNpZ25hbCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSc7XG5cbmV4cG9ydCB0eXBlIFBhZ2luYXRvclN0YXRlID0ge1xuXHRjdXJyZW50UGFnZTogbnVtYmVyO1xuXHRzdGFydEluZGV4OiBudW1iZXI7XG5cdGVuZEluZGV4OiBudW1iZXI7XG5cdHBhZ2VTaXplOiBudW1iZXI7XG5cdHRvdGFsUGFnZXM6IG51bWJlcjtcblx0dG90YWxFbGVtZW50czogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZDtcbn07XG5cbmV4cG9ydCB0eXBlIFBhZ2luYXRvckNvbnRleHQgPSB7XG5cdCRpbXBsaWNpdDoge1xuXHRcdHN0YXRlOiBTaWduYWw8UGFnaW5hdG9yU3RhdGU+O1xuXHRcdGluY3JlbWVudGFibGU6IFNpZ25hbDxib29sZWFuPjtcblx0XHRkZWNyZW1lbnRhYmxlOiBTaWduYWw8Ym9vbGVhbj47XG5cdFx0aW5jcmVtZW50OiAoKSA9PiB2b2lkO1xuXHRcdGRlY3JlbWVudDogKCkgPT4gdm9pZDtcblx0fTtcbn07XG5cbkBEaXJlY3RpdmUoe1xuXHRzdGFuZGFsb25lOiB0cnVlLFxuXHRzZWxlY3RvcjogJ1ticm5QYWdpbmF0b3JdJyxcblx0ZXhwb3J0QXM6ICdicm5QYWdpbmF0b3InLFxufSlcbmV4cG9ydCBjbGFzcyBCcm5QYWdpbmF0b3JEaXJlY3RpdmUgaW1wbGVtZW50cyBPbkluaXQge1xuXHRzdGF0aWMgbmdUZW1wbGF0ZUNvbnRleHRHdWFyZChkaXJlY3RpdmU6IEJyblBhZ2luYXRvckRpcmVjdGl2ZSwgY29udGV4dDogdW5rbm93bik6IGNvbnRleHQgaXMgUGFnaW5hdG9yQ29udGV4dCB7XG5cdFx0cmV0dXJuIHRydWU7XG5cdH1cblxuXHRwcml2YXRlIHJlYWRvbmx5IF92Y3IgPSBpbmplY3QoVmlld0NvbnRhaW5lclJlZik7XG5cdHByaXZhdGUgcmVhZG9ubHkgX3RlbXBsYXRlID0gaW5qZWN0KFRlbXBsYXRlUmVmPHVua25vd24+KTtcblxuXHRwcml2YXRlIHJlYWRvbmx5IF9zdGF0ZSA9IHNpZ25hbDxQYWdpbmF0b3JTdGF0ZT4oe1xuXHRcdGN1cnJlbnRQYWdlOiAwLFxuXHRcdHN0YXJ0SW5kZXg6IDAsXG5cdFx0ZW5kSW5kZXg6IDAsXG5cdFx0cGFnZVNpemU6IDEwLFxuXHRcdHRvdGFsUGFnZXM6IDAsXG5cdFx0dG90YWxFbGVtZW50czogbnVsbCxcblx0fSk7XG5cdHByaXZhdGUgcmVhZG9ubHkgX2RlY3JlbWVudGFibGUgPSBjb21wdXRlZCgoKSA9PiAwIDwgdGhpcy5fc3RhdGUoKS5zdGFydEluZGV4KTtcblx0cHJpdmF0ZSByZWFkb25seSBfaW5jcmVtZW50YWJsZSA9IGNvbXB1dGVkKCgpID0+IHRoaXMuX3N0YXRlKCkuZW5kSW5kZXggPCAodGhpcy5fc3RhdGUoKS50b3RhbEVsZW1lbnRzID8/IDApIC0gMSk7XG5cblx0QElucHV0KHsgYWxpYXM6ICdicm5QYWdpbmF0b3JUb3RhbEVsZW1lbnRzJyB9KVxuXHRzZXQgdG90YWxFbGVtZW50cyh2YWx1ZTogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZCkge1xuXHRcdHRoaXMuY2FsY3VsYXRlTmV3U3RhdGUoeyBuZXdUb3RhbEVsZW1lbnRzOiB2YWx1ZSwgbmV3UGFnZTogMCB9KTtcblx0fVxuXG5cdEBJbnB1dCh7IGFsaWFzOiAnYnJuUGFnaW5hdG9yQ3VycmVudFBhZ2UnLCB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZSB9KVxuXHRzZXQgY3VycmVudFBhZ2UodmFsdWU6IG51bWJlcikge1xuXHRcdHRoaXMuY2FsY3VsYXRlTmV3U3RhdGUoeyBuZXdQYWdlOiB2YWx1ZSB9KTtcblx0fVxuXG5cdEBJbnB1dCh7IGFsaWFzOiAnYnJuUGFnaW5hdG9yUGFnZVNpemUnLCB0cmFuc2Zvcm06IG51bWJlckF0dHJpYnV0ZSB9KVxuXHRzZXQgcGFnZVNpemUodmFsdWU6IG51bWJlcikge1xuXHRcdHRoaXMuY2FsY3VsYXRlTmV3U3RhdGUoeyBuZXdQYWdlU2l6ZTogdmFsdWUsIG5ld1BhZ2U6IDAgfSk7XG5cdH1cblxuXHRASW5wdXQoeyBhbGlhczogJ2JyblBhZ2luYXRvck9uU3RhdGVDaGFuZ2UnIH0pXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktZnVuY3Rpb25cblx0cHVibGljIG9uU3RhdGVDaGFuZ2U/OiAoc3RhdGU6IFBhZ2luYXRvclN0YXRlKSA9PiB2b2lkO1xuXG5cdGNvbnN0cnVjdG9yKCkge1xuXHRcdGVmZmVjdChcblx0XHRcdCgpID0+IHtcblx0XHRcdFx0Y29uc3Qgc3RhdGUgPSB0aGlzLl9zdGF0ZSgpO1xuXHRcdFx0XHRQcm9taXNlLnJlc29sdmUoKS50aGVuKCgpID0+IHtcblx0XHRcdFx0XHRpZiAodGhpcy5vblN0YXRlQ2hhbmdlKSB7XG5cdFx0XHRcdFx0XHR0aGlzLm9uU3RhdGVDaGFuZ2Uoc3RhdGUpO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0fSk7XG5cdFx0XHR9LFxuXHRcdFx0eyBhbGxvd1NpZ25hbFdyaXRlczogdHJ1ZSB9LFxuXHRcdCk7XG5cdH1cblxuXHRwdWJsaWMgbmdPbkluaXQoKSB7XG5cdFx0dGhpcy5fdmNyLmNyZWF0ZUVtYmVkZGVkVmlldzxQYWdpbmF0b3JDb250ZXh0Pih0aGlzLl90ZW1wbGF0ZSwge1xuXHRcdFx0JGltcGxpY2l0OiB7XG5cdFx0XHRcdHN0YXRlOiB0aGlzLl9zdGF0ZSxcblx0XHRcdFx0aW5jcmVtZW50OiAoKSA9PiB0aGlzLmluY3JlbWVudFBhZ2UoKSxcblx0XHRcdFx0ZGVjcmVtZW50OiAoKSA9PiB0aGlzLmRlY3JlbWVudFBhZ2UoKSxcblx0XHRcdFx0aW5jcmVtZW50YWJsZTogdGhpcy5faW5jcmVtZW50YWJsZSxcblx0XHRcdFx0ZGVjcmVtZW50YWJsZTogdGhpcy5fZGVjcmVtZW50YWJsZSxcblx0XHRcdH0sXG5cdFx0fSk7XG5cdH1cblxuXHRwdWJsaWMgZGVjcmVtZW50UGFnZSgpOiB2b2lkIHtcblx0XHRjb25zdCB7IGN1cnJlbnRQYWdlIH0gPSB0aGlzLl9zdGF0ZSgpO1xuXHRcdGlmICgwIDwgY3VycmVudFBhZ2UpIHtcblx0XHRcdHRoaXMuY2FsY3VsYXRlTmV3U3RhdGUoeyBuZXdQYWdlOiBjdXJyZW50UGFnZSAtIDEgfSk7XG5cdFx0fVxuXHR9XG5cblx0cHVibGljIGluY3JlbWVudFBhZ2UoKTogdm9pZCB7XG5cdFx0Y29uc3QgeyBjdXJyZW50UGFnZSwgdG90YWxQYWdlcyB9ID0gdGhpcy5fc3RhdGUoKTtcblx0XHRpZiAodG90YWxQYWdlcyA+IGN1cnJlbnRQYWdlKSB7XG5cdFx0XHR0aGlzLmNhbGN1bGF0ZU5ld1N0YXRlKHsgbmV3UGFnZTogY3VycmVudFBhZ2UgKyAxIH0pO1xuXHRcdH1cblx0fVxuXG5cdHB1YmxpYyByZXNldCgpOiB2b2lkIHtcblx0XHR0aGlzLmN1cnJlbnRQYWdlID0gMDtcblx0fVxuXG5cdHByaXZhdGUgY2FsY3VsYXRlTmV3U3RhdGUoe1xuXHRcdG5ld1BhZ2UsXG5cdFx0bmV3UGFnZVNpemUsXG5cdFx0bmV3VG90YWxFbGVtZW50cyxcblx0fTogUGFydGlhbDx7XG5cdFx0bmV3UGFnZTogbnVtYmVyO1xuXHRcdG5ld1BhZ2VTaXplOiBudW1iZXI7XG5cdFx0bmV3VG90YWxFbGVtZW50czogbnVtYmVyIHwgbnVsbCB8IHVuZGVmaW5lZDtcblx0fT4pIHtcblx0XHRjb25zdCBwcmV2aW91c1N0YXRlID0gdGhpcy5fc3RhdGUoKTtcblxuXHRcdGxldCBjdXJyZW50UGFnZSA9IG5ld1BhZ2UgPz8gcHJldmlvdXNTdGF0ZS5jdXJyZW50UGFnZTtcblx0XHRjb25zdCBwYWdlU2l6ZSA9IG5ld1BhZ2VTaXplID8/IHByZXZpb3VzU3RhdGUucGFnZVNpemU7XG5cdFx0Y29uc3QgdG90YWxFbGVtZW50cyA9IG5ld1RvdGFsRWxlbWVudHMgPz8gcHJldmlvdXNTdGF0ZS50b3RhbEVsZW1lbnRzID8/IDA7XG5cblx0XHRjb25zdCBuZXdUb3RhbFBhZ2VzID0gdG90YWxFbGVtZW50cyA/IE1hdGguZmxvb3IodG90YWxFbGVtZW50cyAvIHBhZ2VTaXplKSA6IDA7XG5cblx0XHRpZiAobmV3VG90YWxQYWdlcyA8IGN1cnJlbnRQYWdlIC0gMSkge1xuXHRcdFx0Y3VycmVudFBhZ2UgPSBuZXdUb3RhbFBhZ2VzIC0gMTtcblx0XHR9XG5cblx0XHRjb25zdCBuZXdTdGFydEluZGV4ID0gdG90YWxFbGVtZW50cyA9PT0gMCA/IDAgOiBNYXRoLm1pbih0b3RhbEVsZW1lbnRzIC0gMSwgY3VycmVudFBhZ2UgKiBwYWdlU2l6ZSk7XG5cdFx0Y29uc3QgbmV3RW5kSW5kZXggPSBNYXRoLm1pbigoY3VycmVudFBhZ2UgKyAxKSAqIHBhZ2VTaXplIC0gMSwgdG90YWxFbGVtZW50cyAtIDEpO1xuXG5cdFx0Y29uc3QgbmV3U3RhdGUgPSB7XG5cdFx0XHRjdXJyZW50UGFnZTogY3VycmVudFBhZ2UsXG5cdFx0XHRzdGFydEluZGV4OiBuZXdTdGFydEluZGV4LFxuXHRcdFx0ZW5kSW5kZXg6IG5ld0VuZEluZGV4LFxuXHRcdFx0cGFnZVNpemU6IHBhZ2VTaXplLFxuXHRcdFx0dG90YWxQYWdlczogbmV3VG90YWxQYWdlcyxcblx0XHRcdHRvdGFsRWxlbWVudHM6IHRvdGFsRWxlbWVudHMsXG5cdFx0fTtcblxuXHRcdHRoaXMuX3N0YXRlLnNldChuZXdTdGF0ZSk7XG5cdH1cbn1cbiJdfQ==