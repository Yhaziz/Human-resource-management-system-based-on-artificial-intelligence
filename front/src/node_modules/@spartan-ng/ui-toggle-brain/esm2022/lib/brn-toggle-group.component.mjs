import { SelectionModel } from '@angular/cdk/collections';
import { ChangeDetectorRef, Component, ContentChildren, DestroyRef, EventEmitter, Input, Output, booleanAttribute, forwardRef, inject, } from '@angular/core';
import { takeUntilDestroyed } from '@angular/core/rxjs-interop';
import { NG_VALUE_ACCESSOR } from '@angular/forms';
import { map, merge, of, startWith, switchMap } from 'rxjs';
import { BrnToggleDirective } from './brn-toggle.directive';
import { ToggleGroupCanBeNullableProvider } from './toggle-group-can-be-nullable-provider';
import * as i0 from "@angular/core";
export const BRN_BUTTON_TOGGLE_GROUP_VALUE_ACCESSOR = {
    provide: NG_VALUE_ACCESSOR,
    useExisting: forwardRef(() => BrnToggleGroupComponent),
    multi: true,
};
let uniqueIdCounter = 0;
export class BrnButtonToggleChange {
    constructor(source, 
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    value) {
        this.source = source;
        this.value = value;
    }
}
export class BrnToggleGroupComponent {
    constructor() {
        this._cdr = inject(ChangeDetectorRef);
        this._destroyRef = inject(DestroyRef);
        this._vertical = false;
        this._multiple = false;
        this._nullable = false;
        this._skipNullableCheck = false;
        this._disabled = false;
        /**
         * The method to be called in order to update ngModel.
         */
        // eslint-disable-next-line @typescript-eslint/no-empty-function,@typescript-eslint/no-explicit-any
        this._controlValueAccessorChangeFn = () => { };
        /** onTouch function registered via registerOnTouch (ControlValueAccessor). */
        // eslint-disable-next-line @typescript-eslint/no-empty-function,@typescript-eslint/no-explicit-any
        this._onTouched = () => { };
        this._name = `brn-button-toggle-group-${uniqueIdCounter++}`;
        // eslint-disable-next-line @typescript-eslint/no-explicit-any
        this.valueChange = new EventEmitter();
        this.change = new EventEmitter();
    }
    get name() {
        return this._name;
    }
    set name(value) {
        this._name = value;
        this._markTogglesForCheck();
    }
    get vertical() {
        return this._vertical;
    }
    set vertical(value) {
        this._vertical = value;
    }
    /** Value of the toggle group. */
    get value() {
        const selected = this._selectionModel ? this._selectionModel.selected : [];
        if (this.multiple) {
            return selected.map((toggle) => toggle.value);
        }
        return selected[0] ? selected[0].value : undefined;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    set value(newValue) {
        if (this._disabled) {
            return;
        }
        this._setSelectionByValue(newValue);
        this.valueChange.emit(this.value);
    }
    /** Selected button toggles in the group. */
    get selected() {
        const selected = this._selectionModel ? this._selectionModel.selected : [];
        return this.multiple ? selected : selected[0] || null;
    }
    /** Whether no button toggles need to be selected. */
    get nullable() {
        return this._nullable;
    }
    set nullable(value) {
        this._nullable = value;
        this._markTogglesForCheck();
    }
    /** Whether multiple button toggles can be selected. */
    get multiple() {
        return this._multiple;
    }
    set multiple(value) {
        this._multiple = value;
        this._markTogglesForCheck();
    }
    get disabled() {
        return this._disabled;
    }
    set disabled(value) {
        this._disabled = value;
        this._buttonToggles?.forEach((toggle) => (toggle.disabled = this._disabled));
        this._markTogglesForCheck();
    }
    ngOnInit() {
        this._selectionModel = new SelectionModel(this.multiple, undefined, false);
    }
    ngAfterContentInit() {
        if (!this._selectionModel || !this._buttonToggles)
            return;
        this._selectionModel.select(...this._buttonToggles.filter((toggle) => toggle.isOn()));
        this._buttonToggles.changes
            .pipe(startWith(this._buttonToggles), switchMap(() => {
            if (!this._buttonToggles)
                return of();
            return merge(...this._buttonToggles
                .toArray()
                .map((toggle) => toggle.toggled.asObservable().pipe(map((state) => ({ toggle: toggle, state })))));
        }), takeUntilDestroyed(this._destroyRef))
            .subscribe(({ state, toggle }) => {
            if (!this._selectionModel) {
                return;
            }
            this._onTouched();
            if (state === 'on') {
                if (!this.multiple) {
                    this._skipNullableCheck = true;
                    this._selectionModel.selected.forEach((s) => s.toggleOff());
                    this._skipNullableCheck = false;
                }
                this._selectionModel.select(toggle);
            }
            else {
                this._selectionModel.deselect(toggle);
            }
            this._updateModelValue(toggle);
        });
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    writeValue(value) {
        this.value = value;
        this._cdr.markForCheck();
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    registerOnChange(fn) {
        this._controlValueAccessorChangeFn = fn;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    registerOnTouched(fn) {
        this._onTouched = fn;
    }
    setDisabledState(isDisabled) {
        this.disabled = isDisabled;
    }
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    _canBeNullable(value) {
        if (this._nullable || this._skipNullableCheck)
            return true;
        if (this._multiple) {
            // eslint-disable-next-line @typescript-eslint/no-explicit-any
            return !(this.value.length === 1 && this.value[0] === value);
        }
        return this.value !== value;
    }
    /** Updates the selection state of the toggles in the group based on a value. */
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    _setSelectionByValue(value) {
        if (!this._buttonToggles) {
            return;
        }
        if (this.multiple && value) {
            if (!Array.isArray(value)) {
                throw Error('Value must be an array in multiple-selection mode.');
            }
            this._clearSelection();
            value.forEach((currentValue) => this._selectValue(currentValue));
        }
        else {
            this._clearSelection();
            this._selectValue(value);
        }
    }
    /** Clears the selected toggles. */
    _clearSelection() {
        if (!this._selectionModel)
            return;
        this._selectionModel.clear();
        (this._buttonToggles ?? []).forEach((toggle) => toggle.toggleOff());
    }
    /** Selects a value if there's a toggle that corresponds to it. */
    // eslint-disable-next-line @typescript-eslint/no-explicit-any
    _selectValue(value) {
        if (!this._selectionModel)
            return;
        const correspondingOption = (this._buttonToggles ?? []).find((toggle) => {
            return toggle.value != null && toggle.value === value;
        });
        if (correspondingOption) {
            correspondingOption.toggleOn();
        }
    }
    _updateModelValue(toggle) {
        const value = this.value;
        const event = new BrnButtonToggleChange(toggle, value);
        this._controlValueAccessorChangeFn(value);
        this.change.emit(event);
        this.valueChange.emit(value);
    }
    /** Marks all the child button toggles to be checked. */
    _markTogglesForCheck() {
        this._buttonToggles?.forEach((toggle) => toggle._markForCheck());
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnToggleGroupComponent, deps: [], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "16.1.0", version: "17.3.5", type: BrnToggleGroupComponent, isStandalone: true, selector: "brn-toggle-group", inputs: { name: "name", vertical: ["vertical", "vertical", booleanAttribute], value: "value", nullable: ["nullable", "nullable", booleanAttribute], multiple: ["multiple", "multiple", booleanAttribute], disabled: ["disabled", "disabled", booleanAttribute] }, outputs: { valueChange: "valueChange", change: "change" }, host: { attributes: { "role": "group" }, properties: { "attr.aria-disabled": "disabled", "attr.data-disabled": "disabled", "attr.data-vertical": "vertical" }, classAttribute: "brn-button-toggle-group" }, providers: [
            BRN_BUTTON_TOGGLE_GROUP_VALUE_ACCESSOR,
            {
                provide: ToggleGroupCanBeNullableProvider,
                useExisting: forwardRef(() => BrnToggleGroupComponent),
            },
        ], queries: [{ propertyName: "_buttonToggles", predicate: BrnToggleDirective, descendants: true }], exportAs: ["brnToggleGroup"], ngImport: i0, template: `
		<ng-content />
	`, isInline: true }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "17.3.5", ngImport: i0, type: BrnToggleGroupComponent, decorators: [{
            type: Component,
            args: [{
                    selector: 'brn-toggle-group',
                    standalone: true,
                    providers: [
                        BRN_BUTTON_TOGGLE_GROUP_VALUE_ACCESSOR,
                        {
                            provide: ToggleGroupCanBeNullableProvider,
                            useExisting: forwardRef(() => BrnToggleGroupComponent),
                        },
                    ],
                    host: {
                        role: 'group',
                        class: 'brn-button-toggle-group',
                        '[attr.aria-disabled]': 'disabled',
                        '[attr.data-disabled]': 'disabled',
                        '[attr.data-vertical]': 'vertical',
                    },
                    exportAs: 'brnToggleGroup',
                    template: `
		<ng-content />
	`,
                }]
        }], propDecorators: { _buttonToggles: [{
                type: ContentChildren,
                args: [BrnToggleDirective, {
                        // Note that this would technically pick up toggles
                        // from nested groups, but that's not a case that we support.
                        descendants: true,
                    }]
            }], name: [{
                type: Input
            }], vertical: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], value: [{
                type: Input
            }], valueChange: [{
                type: Output
            }], nullable: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], multiple: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], disabled: [{
                type: Input,
                args: [{ transform: booleanAttribute }]
            }], change: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnJuLXRvZ2dsZS1ncm91cC5jb21wb25lbnQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyIuLi8uLi8uLi8uLi8uLi8uLi8uLi9saWJzL3VpL3RvZ2dsZS9icmFpbi9zcmMvbGliL2Jybi10b2dnbGUtZ3JvdXAuY29tcG9uZW50LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLE9BQU8sRUFBRSxjQUFjLEVBQUUsTUFBTSwwQkFBMEIsQ0FBQztBQUMxRCxPQUFPLEVBQ04saUJBQWlCLEVBQ2pCLFNBQVMsRUFDVCxlQUFlLEVBQ2YsVUFBVSxFQUNWLFlBQVksRUFDWixLQUFLLEVBQ0wsTUFBTSxFQUNOLGdCQUFnQixFQUNoQixVQUFVLEVBQ1YsTUFBTSxHQUlOLE1BQU0sZUFBZSxDQUFDO0FBQ3ZCLE9BQU8sRUFBRSxrQkFBa0IsRUFBRSxNQUFNLDRCQUE0QixDQUFDO0FBQ2hFLE9BQU8sRUFBRSxpQkFBaUIsRUFBNkIsTUFBTSxnQkFBZ0IsQ0FBQztBQUM5RSxPQUFPLEVBQUUsR0FBRyxFQUFFLEtBQUssRUFBRSxFQUFFLEVBQUUsU0FBUyxFQUFFLFNBQVMsRUFBRSxNQUFNLE1BQU0sQ0FBQztBQUM1RCxPQUFPLEVBQUUsa0JBQWtCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUM1RCxPQUFPLEVBQUUsZ0NBQWdDLEVBQUUsTUFBTSx5Q0FBeUMsQ0FBQzs7QUFFM0YsTUFBTSxDQUFDLE1BQU0sc0NBQXNDLEdBQUc7SUFDckQsT0FBTyxFQUFFLGlCQUFpQjtJQUMxQixXQUFXLEVBQUUsVUFBVSxDQUFDLEdBQUcsRUFBRSxDQUFDLHVCQUF1QixDQUFDO0lBQ3RELEtBQUssRUFBRSxJQUFJO0NBQ1gsQ0FBQztBQUVGLElBQUksZUFBZSxHQUFHLENBQUMsQ0FBQztBQUV4QixNQUFNLE9BQU8scUJBQXFCO0lBQ2pDLFlBQ1EsTUFBMEI7SUFDakMsOERBQThEO0lBQ3ZELEtBQVU7UUFGVixXQUFNLEdBQU4sTUFBTSxDQUFvQjtRQUUxQixVQUFLLEdB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TCxJQUFJLEVBQUUsT0FBTzt3QkFDYixLQUFLLEVBQUUseUJBQXlCO3dCQUNoQyxzQkFBc0IsRUFBRSxVQUFVO3dCQUNsQyxzQkFBc0IsRUFBRSxVQUFVO3dCQUNsQyxzQkFBc0IsRUFBRSxVQUFVO3FCQUNsQztvQkFDRCxRQUFRLEVBQUUsZ0JBQWdCO29CQUMxQixRQUFRLEVBQUU7O0VBRVQ7aUJBQ0Q7OEJBNEJBLGNBQWM7c0JBTGIsZUFBZTt1QkFBQyxrQkFBa0IsRUFBRTt3QkFDcEMsbURBQW1EO3dCQUNuRCw2REFBNkQ7d0JBQzdELFdBQVcsRUFBRSxJQUFJO3FCQUNqQjtnQkFLRyxJQUFJO3NCQURQLEtBQUs7Z0JBV0YsUUFBUTtzQkFEWCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQVdsQyxLQUFLO3NCQURSLEtBQUs7Z0JBcUJhLFdBQVc7c0JBQTdCLE1BQU07Z0JBVUgsUUFBUTtzQkFEWCxLQUFLO3VCQUFDLEVBQUUsU0FBUyxFQUFFLGdCQUFnQixFQUFFO2dCQVlsQyxRQUFRO3NCQURYLEtBQUs7dUJBQUMsRUFBRSxTQUFTLEVBQUUsZ0JBQWdCLEVBQUU7Z0JBV2xDLFFBQVE7c0JBRFgsS0FBSzt1QkFBQyxFQUFFLFNBQVMsRUFBRSxnQkFBZ0IsRUFBRTtnQkFhN0IsTUFBTTtzQkFGZCxNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgU2VsZWN0aW9uTW9kZWwgfSBmcm9tICdAYW5ndWxhci9jZGsvY29sbGVjdGlvbnMnO1xuaW1wb3J0IHtcblx0Q2hhbmdlRGV0ZWN0b3JSZWYsXG5cdENvbXBvbmVudCxcblx0Q29udGVudENoaWxkcmVuLFxuXHREZXN0cm95UmVmLFxuXHRFdmVudEVtaXR0ZXIsXG5cdElucHV0LFxuXHRPdXRwdXQsXG5cdGJvb2xlYW5BdHRyaWJ1dGUsXG5cdGZvcndhcmRSZWYsXG5cdGluamVjdCxcblx0dHlwZSBBZnRlckNvbnRlbnRJbml0LFxuXHR0eXBlIE9uSW5pdCxcblx0dHlwZSBRdWVyeUxpc3QsXG59IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xuaW1wb3J0IHsgdGFrZVVudGlsRGVzdHJveWVkIH0gZnJvbSAnQGFuZ3VsYXIvY29yZS9yeGpzLWludGVyb3AnO1xuaW1wb3J0IHsgTkdfVkFMVUVfQUNDRVNTT1IsIHR5cGUgQ29udHJvbFZhbHVlQWNjZXNzb3IgfSBmcm9tICdAYW5ndWxhci9mb3Jtcyc7XG5pbXBvcnQgeyBtYXAsIG1lcmdlLCBvZiwgc3RhcnRXaXRoLCBzd2l0Y2hNYXAgfSBmcm9tICdyeGpzJztcbmltcG9ydCB7IEJyblRvZ2dsZURpcmVjdGl2ZSB9IGZyb20gJy4vYnJuLXRvZ2dsZS5kaXJlY3RpdmUnO1xuaW1wb3J0IHsgVG9nZ2xlR3JvdXBDYW5CZU51bGxhYmxlUHJvdmlkZXIgfSBmcm9tICcuL3RvZ2dsZS1ncm91cC1jYW4tYmUtbnVsbGFibGUtcHJvdmlkZXInO1xuXG5leHBvcnQgY29uc3QgQlJOX0JVVFRPTl9UT0dHTEVfR1JPVVBfVkFMVUVfQUNDRVNTT1IgPSB7XG5cdHByb3ZpZGU6IE5HX1ZBTFVFX0FDQ0VTU09SLFxuXHR1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBCcm5Ub2dnbGVHcm91cENvbXBvbmVudCksXG5cdG11bHRpOiB0cnVlLFxufTtcblxubGV0IHVuaXF1ZUlkQ291bnRlciA9IDA7XG5cbmV4cG9ydCBjbGFzcyBCcm5CdXR0b25Ub2dnbGVDaGFuZ2Uge1xuXHRjb25zdHJ1Y3Rvcihcblx0XHRwdWJsaWMgc291cmNlOiBCcm5Ub2dnbGVEaXJlY3RpdmUsXG5cdFx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcblx0XHRwdWJsaWMgdmFsdWU6IGFueSxcblx0KSB7fVxufVxuXG5AQ29tcG9uZW50KHtcblx0c2VsZWN0b3I6ICdicm4tdG9nZ2xlLWdyb3VwJyxcblx0c3RhbmRhbG9uZTogdHJ1ZSxcblx0cHJvdmlkZXJzOiBbXG5cdFx0QlJOX0JVVFRPTl9UT0dHTEVfR1JPVVBfVkFMVUVfQUNDRVNTT1IsXG5cdFx0e1xuXHRcdFx0cHJvdmlkZTogVG9nZ2xlR3JvdXBDYW5CZU51bGxhYmxlUHJvdmlkZXIsXG5cdFx0XHR1c2VFeGlzdGluZzogZm9yd2FyZFJlZigoKSA9PiBCcm5Ub2dnbGVHcm91cENvbXBvbmVudCksXG5cdFx0fSxcblx0XSxcblx0aG9zdDoge1xuXHRcdHJvbGU6ICdncm91cCcsXG5cdFx0Y2xhc3M6ICdicm4tYnV0dG9uLXRvZ2dsZS1ncm91cCcsXG5cdFx0J1thdHRyLmFyaWEtZGlzYWJsZWRdJzogJ2Rpc2FibGVkJyxcblx0XHQnW2F0dHIuZGF0YS1kaXNhYmxlZF0nOiAnZGlzYWJsZWQnLFxuXHRcdCdbYXR0ci5kYXRhLXZlcnRpY2FsXSc6ICd2ZXJ0aWNhbCcsXG5cdH0sXG5cdGV4cG9ydEFzOiAnYnJuVG9nZ2xlR3JvdXAnLFxuXHR0ZW1wbGF0ZTogYFxuXHRcdDxuZy1jb250ZW50IC8+XG5cdGAsXG59KVxuZXhwb3J0IGNsYXNzIEJyblRvZ2dsZUdyb3VwQ29tcG9uZW50XG5cdGltcGxlbWVudHMgQ29udHJvbFZhbHVlQWNjZXNzb3IsIE9uSW5pdCwgQWZ0ZXJDb250ZW50SW5pdCwgVG9nZ2xlR3JvdXBDYW5CZU51bGxhYmxlUHJvdmlkZXJcbntcblx0cHJpdmF0ZSByZWFkb25seSBfY2RyID0gaW5qZWN0KENoYW5nZURldGVjdG9yUmVmKTtcblx0cHJpdmF0ZSByZWFkb25seSBfZGVzdHJveVJlZiA9IGluamVjdChEZXN0cm95UmVmKTtcblx0cHJpdmF0ZSBfdmVydGljYWwgPSBmYWxzZTtcblx0cHJpdmF0ZSBfbXVsdGlwbGUgPSBmYWxzZTtcblx0cHJpdmF0ZSBfbnVsbGFibGUgPSBmYWxzZTtcblx0cHJpdmF0ZSBfc2tpcE51bGxhYmxlQ2hlY2sgPSBmYWxzZTtcblx0cHJpdmF0ZSBfZGlzYWJsZWQgPSBmYWxzZTtcblx0cHJpdmF0ZSBfc2VsZWN0aW9uTW9kZWw/OiBTZWxlY3Rpb25Nb2RlbDxCcm5Ub2dnbGVEaXJlY3RpdmU+O1xuXG5cdC8qKlxuXHQgKiBUaGUgbWV0aG9kIHRvIGJlIGNhbGxlZCBpbiBvcmRlciB0byB1cGRhdGUgbmdNb2RlbC5cblx0ICovXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZW1wdHktZnVuY3Rpb24sQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuXHRwcml2YXRlIF9jb250cm9sVmFsdWVBY2Nlc3NvckNoYW5nZUZuOiAodmFsdWU6IGFueSkgPT4gdm9pZCA9ICgpID0+IHt9O1xuXG5cdC8qKiBvblRvdWNoIGZ1bmN0aW9uIHJlZ2lzdGVyZWQgdmlhIHJlZ2lzdGVyT25Ub3VjaCAoQ29udHJvbFZhbHVlQWNjZXNzb3IpLiAqL1xuXHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWVtcHR5LWZ1bmN0aW9uLEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcblx0cHJpdmF0ZSBfb25Ub3VjaGVkOiAoKSA9PiBhbnkgPSAoKSA9PiB7fTtcblxuXHRAQ29udGVudENoaWxkcmVuKEJyblRvZ2dsZURpcmVjdGl2ZSwge1xuXHRcdC8vIE5vdGUgdGhhdCB0aGlzIHdvdWxkIHRlY2huaWNhbGx5IHBpY2sgdXAgdG9nZ2xlc1xuXHRcdC8vIGZyb20gbmVzdGVkIGdyb3VwcywgYnV0IHRoYXQncyBub3QgYSBjYXNlIHRoYXQgd2Ugc3VwcG9ydC5cblx0XHRkZXNjZW5kYW50czogdHJ1ZSxcblx0fSlcblx0X2J1dHRvblRvZ2dsZXM/OiBRdWVyeUxpc3Q8QnJuVG9nZ2xlRGlyZWN0aXZlPjtcblxuXHRwcml2YXRlIF9uYW1lID0gYGJybi1idXR0b24tdG9nZ2xlLWdyb3VwLSR7dW5pcXVlSWRDb3VudGVyKyt9YDtcblx0QElucHV0KClcblx0Z2V0IG5hbWUoKTogc3RyaW5nIHtcblx0XHRyZXR1cm4gdGhpcy5fbmFtZTtcblx0fVxuXG5cdHNldCBuYW1lKHZhbHVlOiBzdHJpbmcpIHtcblx0XHR0aGlzLl9uYW1lID0gdmFsdWU7XG5cdFx0dGhpcy5fbWFya1RvZ2dsZXNGb3JDaGVjaygpO1xuXHR9XG5cblx0QElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pXG5cdGdldCB2ZXJ0aWNhbCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5fdmVydGljYWw7XG5cdH1cblxuXHRzZXQgdmVydGljYWwodmFsdWU6IGJvb2xlYW4pIHtcblx0XHR0aGlzLl92ZXJ0aWNhbCA9IHZhbHVlO1xuXHR9XG5cblx0LyoqIFZhbHVlIG9mIHRoZSB0b2dnbGUgZ3JvdXAuICovXG5cdEBJbnB1dCgpIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5cdGdldCB2YWx1ZSgpOiBhbnkge1xuXHRcdGNvbnN0IHNlbGVjdGVkID0gdGhpcy5fc2VsZWN0aW9uTW9kZWwgPyB0aGlzLl9zZWxlY3Rpb25Nb2RlbC5zZWxlY3RlZCA6IFtdO1xuXG5cdFx0aWYgKHRoaXMubXVsdGlwbGUpIHtcblx0XHRcdHJldHVybiBzZWxlY3RlZC5tYXAoKHRvZ2dsZSkgPT4gdG9nZ2xlLnZhbHVlKTtcblx0XHR9XG5cblx0XHRyZXR1cm4gc2VsZWN0ZWRbMF0gPyBzZWxlY3RlZFswXS52YWx1ZSA6IHVuZGVmaW5lZDtcblx0fVxuXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5cdHNldCB2YWx1ZShuZXdWYWx1ZTogYW55KSB7XG5cdFx0aWYgKHRoaXMuX2Rpc2FibGVkKSB7XG5cdFx0XHRyZXR1cm47XG5cdFx0fVxuXHRcdHRoaXMuX3NldFNlbGVjdGlvbkJ5VmFsdWUobmV3VmFsdWUpO1xuXHRcdHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh0aGlzLnZhbHVlKTtcblx0fVxuXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5cdEBPdXRwdXQoKSByZWFkb25seSB2YWx1ZUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8YW55PigpO1xuXG5cdC8qKiBTZWxlY3RlZCBidXR0b24gdG9nZ2xlcyBpbiB0aGUgZ3JvdXAuICovXG5cdGdldCBzZWxlY3RlZCgpOiBCcm5Ub2dnbGVEaXJlY3RpdmUgfCBCcm5Ub2dnbGVEaXJlY3RpdmVbXSB7XG5cdFx0Y29uc3Qgc2VsZWN0ZWQgPSB0aGlzLl9zZWxlY3Rpb25Nb2RlbCA/IHRoaXMuX3NlbGVjdGlvbk1vZGVsLnNlbGVjdGVkIDogW107XG5cdFx0cmV0dXJuIHRoaXMubXVsdGlwbGUgPyBzZWxlY3RlZCA6IHNlbGVjdGVkWzBdIHx8IG51bGw7XG5cdH1cblxuXHQvKiogV2hldGhlciBubyBidXR0b24gdG9nZ2xlcyBuZWVkIHRvIGJlIHNlbGVjdGVkLiAqL1xuXHRASW5wdXQoeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSlcblx0Z2V0IG51bGxhYmxlKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLl9udWxsYWJsZTtcblx0fVxuXG5cdHNldCBudWxsYWJsZSh2YWx1ZTogYm9vbGVhbikge1xuXHRcdHRoaXMuX251bGxhYmxlID0gdmFsdWU7XG5cdFx0dGhpcy5fbWFya1RvZ2dsZXNGb3JDaGVjaygpO1xuXHR9XG5cblx0LyoqIFdoZXRoZXIgbXVsdGlwbGUgYnV0dG9uIHRvZ2dsZXMgY2FuIGJlIHNlbGVjdGVkLiAqL1xuXHRASW5wdXQoeyB0cmFuc2Zvcm06IGJvb2xlYW5BdHRyaWJ1dGUgfSlcblx0Z2V0IG11bHRpcGxlKCk6IGJvb2xlYW4ge1xuXHRcdHJldHVybiB0aGlzLl9tdWx0aXBsZTtcblx0fVxuXG5cdHNldCBtdWx0aXBsZSh2YWx1ZTogYm9vbGVhbikge1xuXHRcdHRoaXMuX211bHRpcGxlID0gdmFsdWU7XG5cdFx0dGhpcy5fbWFya1RvZ2dsZXNGb3JDaGVjaygpO1xuXHR9XG5cblx0QElucHV0KHsgdHJhbnNmb3JtOiBib29sZWFuQXR0cmlidXRlIH0pXG5cdGdldCBkaXNhYmxlZCgpOiBib29sZWFuIHtcblx0XHRyZXR1cm4gdGhpcy5fZGlzYWJsZWQ7XG5cdH1cblxuXHRzZXQgZGlzYWJsZWQodmFsdWU6IGJvb2xlYW4pIHtcblx0XHR0aGlzLl9kaXNhYmxlZCA9IHZhbHVlO1xuXHRcdHRoaXMuX2J1dHRvblRvZ2dsZXM/LmZvckVhY2goKHRvZ2dsZSkgPT4gKHRvZ2dsZS5kaXNhYmxlZCA9IHRoaXMuX2Rpc2FibGVkKSk7XG5cdFx0dGhpcy5fbWFya1RvZ2dsZXNGb3JDaGVjaygpO1xuXHR9XG5cblx0QE91dHB1dCgpXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAYW5ndWxhci1lc2xpbnQvbm8tb3V0cHV0LW5hdGl2ZVxuXHRyZWFkb25seSBjaGFuZ2UgPSBuZXcgRXZlbnRFbWl0dGVyPEJybkJ1dHRvblRvZ2dsZUNoYW5nZT4oKTtcblxuXHRuZ09uSW5pdCgpIHtcblx0XHR0aGlzLl9zZWxlY3Rpb25Nb2RlbCA9IG5ldyBTZWxlY3Rpb25Nb2RlbDxCcm5Ub2dnbGVEaXJlY3RpdmU+KHRoaXMubXVsdGlwbGUsIHVuZGVmaW5lZCwgZmFsc2UpO1xuXHR9XG5cblx0bmdBZnRlckNvbnRlbnRJbml0KCkge1xuXHRcdGlmICghdGhpcy5fc2VsZWN0aW9uTW9kZWwgfHwgIXRoaXMuX2J1dHRvblRvZ2dsZXMpIHJldHVybjtcblx0XHR0aGlzLl9zZWxlY3Rpb25Nb2RlbC5zZWxlY3QoLi4udGhpcy5fYnV0dG9uVG9nZ2xlcy5maWx0ZXIoKHRvZ2dsZSkgPT4gdG9nZ2xlLmlzT24oKSkpO1xuXG5cdFx0dGhpcy5fYnV0dG9uVG9nZ2xlcy5jaGFuZ2VzXG5cdFx0XHQucGlwZShcblx0XHRcdFx0c3RhcnRXaXRoKHRoaXMuX2J1dHRvblRvZ2dsZXMpLFxuXHRcdFx0XHRzd2l0Y2hNYXAoKCkgPT4ge1xuXHRcdFx0XHRcdGlmICghdGhpcy5fYnV0dG9uVG9nZ2xlcykgcmV0dXJuIG9mKCk7XG5cdFx0XHRcdFx0cmV0dXJuIG1lcmdlKFxuXHRcdFx0XHRcdFx0Li4udGhpcy5fYnV0dG9uVG9nZ2xlc1xuXHRcdFx0XHRcdFx0XHQudG9BcnJheSgpXG5cdFx0XHRcdFx0XHRcdC5tYXAoKHRvZ2dsZSkgPT4gdG9nZ2xlLnRvZ2dsZWQuYXNPYnNlcnZhYmxlKCkucGlwZShtYXAoKHN0YXRlKSA9PiAoeyB0b2dnbGU6IHRvZ2dsZSwgc3RhdGUgfSkpKSksXG5cdFx0XHRcdFx0KTtcblx0XHRcdFx0fSksXG5cdFx0XHRcdHRha2VVbnRpbERlc3Ryb3llZCh0aGlzLl9kZXN0cm95UmVmKSxcblx0XHRcdClcblx0XHRcdC5zdWJzY3JpYmUoKHsgc3RhdGUsIHRvZ2dsZSB9KSA9PiB7XG5cdFx0XHRcdGlmICghdGhpcy5fc2VsZWN0aW9uTW9kZWwpIHtcblx0XHRcdFx0XHRyZXR1cm47XG5cdFx0XHRcdH1cblx0XHRcdFx0dGhpcy5fb25Ub3VjaGVkKCk7XG5cdFx0XHRcdGlmIChzdGF0ZSA9PT0gJ29uJykge1xuXHRcdFx0XHRcdGlmICghdGhpcy5tdWx0aXBsZSkge1xuXHRcdFx0XHRcdFx0dGhpcy5fc2tpcE51bGxhYmxlQ2hlY2sgPSB0cnVlO1xuXHRcdFx0XHRcdFx0dGhpcy5fc2VsZWN0aW9uTW9kZWwuc2VsZWN0ZWQuZm9yRWFjaCgocykgPT4gcy50b2dnbGVPZmYoKSk7XG5cdFx0XHRcdFx0XHR0aGlzLl9za2lwTnVsbGFibGVDaGVjayA9IGZhbHNlO1xuXHRcdFx0XHRcdH1cblx0XHRcdFx0XHR0aGlzLl9zZWxlY3Rpb25Nb2RlbC5zZWxlY3QodG9nZ2xlKTtcblx0XHRcdFx0fSBlbHNlIHtcblx0XHRcdFx0XHR0aGlzLl9zZWxlY3Rpb25Nb2RlbC5kZXNlbGVjdCh0b2dnbGUpO1xuXHRcdFx0XHR9XG5cdFx0XHRcdHRoaXMuX3VwZGF0ZU1vZGVsVmFsdWUodG9nZ2xlKTtcblx0XHRcdH0pO1xuXHR9XG5cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcblx0d3JpdGVWYWx1ZSh2YWx1ZTogYW55KSB7XG5cdFx0dGhpcy52YWx1ZSA9IHZhbHVlO1xuXHRcdHRoaXMuX2Nkci5tYXJrRm9yQ2hlY2soKTtcblx0fVxuXG5cdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5cdHJlZ2lzdGVyT25DaGFuZ2UoZm46ICh2YWx1ZTogYW55KSA9PiB2b2lkKSB7XG5cdFx0dGhpcy5fY29udHJvbFZhbHVlQWNjZXNzb3JDaGFuZ2VGbiA9IGZuO1xuXHR9XG5cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcblx0cmVnaXN0ZXJPblRvdWNoZWQoZm46IGFueSkge1xuXHRcdHRoaXMuX29uVG91Y2hlZCA9IGZuO1xuXHR9XG5cblx0c2V0RGlzYWJsZWRTdGF0ZShpc0Rpc2FibGVkOiBib29sZWFuKTogdm9pZCB7XG5cdFx0dGhpcy5kaXNhYmxlZCA9IGlzRGlzYWJsZWQ7XG5cdH1cblxuXHQvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueVxuXHRfY2FuQmVOdWxsYWJsZSh2YWx1ZTogYW55KSB7XG5cdFx0aWYgKHRoaXMuX251bGxhYmxlIHx8IHRoaXMuX3NraXBOdWxsYWJsZUNoZWNrKSByZXR1cm4gdHJ1ZTtcblx0XHRpZiAodGhpcy5fbXVsdGlwbGUpIHtcblx0XHRcdC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55XG5cdFx0XHRyZXR1cm4gISgodGhpcy52YWx1ZSBhcyBhbnlbXSkubGVuZ3RoID09PSAxICYmIHRoaXMudmFsdWVbMF0gPT09IHZhbHVlKTtcblx0XHR9XG5cdFx0cmV0dXJuIHRoaXMudmFsdWUgIT09IHZhbHVlO1xuXHR9XG5cblx0LyoqIFVwZGF0ZXMgdGhlIHNlbGVjdGlvbiBzdGF0ZSBvZiB0aGUgdG9nZ2xlcyBpbiB0aGUgZ3JvdXAgYmFzZWQgb24gYSB2YWx1ZS4gKi9cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcblx0cHJpdmF0ZSBfc2V0U2VsZWN0aW9uQnlWYWx1ZSh2YWx1ZTogYW55IHwgYW55W10pIHtcblx0XHRpZiAoIXRoaXMuX2J1dHRvblRvZ2dsZXMpIHtcblx0XHRcdHJldHVybjtcblx0XHR9XG5cblx0XHRpZiAodGhpcy5tdWx0aXBsZSAmJiB2YWx1ZSkge1xuXHRcdFx0aWYgKCFBcnJheS5pc0FycmF5KHZhbHVlKSkge1xuXHRcdFx0XHR0aHJvdyBFcnJvcignVmFsdWUgbXVzdCBiZSBhbiBhcnJheSBpbiBtdWx0aXBsZS1zZWxlY3Rpb24gbW9kZS4nKTtcblx0XHRcdH1cblx0XHRcdHRoaXMuX2NsZWFyU2VsZWN0aW9uKCk7XG5cdFx0XHR2YWx1ZS5mb3JFYWNoKChjdXJyZW50VmFsdWUpID0+IHRoaXMuX3NlbGVjdFZhbHVlKGN1cnJlbnRWYWx1ZSkpO1xuXHRcdH0gZWxzZSB7XG5cdFx0XHR0aGlzLl9jbGVhclNlbGVjdGlvbigpO1xuXHRcdFx0dGhpcy5fc2VsZWN0VmFsdWUodmFsdWUpO1xuXHRcdH1cblx0fVxuXG5cdC8qKiBDbGVhcnMgdGhlIHNlbGVjdGVkIHRvZ2dsZXMuICovXG5cdHByaXZhdGUgX2NsZWFyU2VsZWN0aW9uKCkge1xuXHRcdGlmICghdGhpcy5fc2VsZWN0aW9uTW9kZWwpIHJldHVybjtcblx0XHR0aGlzLl9zZWxlY3Rpb25Nb2RlbC5jbGVhcigpO1xuXHRcdCh0aGlzLl9idXR0b25Ub2dnbGVzID8/IFtdKS5mb3JFYWNoKCh0b2dnbGUpID0+IHRvZ2dsZS50b2dnbGVPZmYoKSk7XG5cdH1cblxuXHQvKiogU2VsZWN0cyBhIHZhbHVlIGlmIHRoZXJlJ3MgYSB0b2dnbGUgdGhhdCBjb3JyZXNwb25kcyB0byBpdC4gKi9cblx0Ly8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIEB0eXBlc2NyaXB0LWVzbGludC9uby1leHBsaWNpdC1hbnlcblx0cHJpdmF0ZSBfc2VsZWN0VmFsdWUodmFsdWU6IGFueSkge1xuXHRcdGlmICghdGhpcy5fc2VsZWN0aW9uTW9kZWwpIHJldHVybjtcblx0XHRjb25zdCBjb3JyZXNwb25kaW5nT3B0aW9uID0gKHRoaXMuX2J1dHRvblRvZ2dsZXMgPz8gW10pLmZpbmQoKHRvZ2dsZSkgPT4ge1xuXHRcdFx0cmV0dXJuIHRvZ2dsZS52YWx1ZSAhPSBudWxsICYmIHRvZ2dsZS52YWx1ZSA9PT0gdmFsdWU7XG5cdFx0fSk7XG5cblx0XHRpZiAoY29ycmVzcG9uZGluZ09wdGlvbikge1xuXHRcdFx0Y29ycmVzcG9uZGluZ09wdGlvbi50b2dnbGVPbigpO1xuXHRcdH1cblx0fVxuXG5cdHByaXZhdGUgX3VwZGF0ZU1vZGVsVmFsdWUodG9nZ2xlOiBCcm5Ub2dnbGVEaXJlY3RpdmUpIHtcblx0XHRjb25zdCB2YWx1ZSA9IHRoaXMudmFsdWU7XG5cdFx0Y29uc3QgZXZlbnQgPSBuZXcgQnJuQnV0dG9uVG9nZ2xlQ2hhbmdlKHRvZ2dsZSwgdmFsdWUpO1xuXHRcdHRoaXMuX2NvbnRyb2xWYWx1ZUFjY2Vzc29yQ2hhbmdlRm4odmFsdWUpO1xuXHRcdHRoaXMuY2hhbmdlLmVtaXQoZXZlbnQpO1xuXHRcdHRoaXMudmFsdWVDaGFuZ2UuZW1pdCh2YWx1ZSk7XG5cdH1cblxuXHQvKiogTWFya3MgYWxsIHRoZSBjaGlsZCBidXR0b24gdG9nZ2xlcyB0byBiZSBjaGVja2VkLiAqL1xuXHRwcml2YXRlIF9tYXJrVG9nZ2xlc0ZvckNoZWNrKCkge1xuXHRcdHRoaXMuX2J1dHRvblRvZ2dsZXM/LmZvckVhY2goKHRvZ2dsZSkgPT4gdG9nZ2xlLl9tYXJrRm9yQ2hlY2soKSk7XG5cdH1cbn1cbiJdfQ==