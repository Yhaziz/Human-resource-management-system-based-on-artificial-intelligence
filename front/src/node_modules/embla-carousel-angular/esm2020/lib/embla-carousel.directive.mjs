import { Directive, ElementRef, EventEmitter, Input, NgZone, Output, inject, } from '@angular/core';
import EmblaCarousel from 'embla-carousel';
import { areOptionsEqual, arePluginsEqual, canUseDOM, } from 'embla-carousel-reactive-utils';
import { Subject, takeUntil, throttleTime } from 'rxjs';
import { EMBLA_OPTIONS_TOKEN } from './utils';
import * as i0 from "@angular/core";
export class EmblaCarouselDirective {
    constructor() {
        this.globalOptions = inject(EMBLA_OPTIONS_TOKEN);
        this.ngZone = inject(NgZone);
        this._elementRef = inject(ElementRef);
        this.options = {};
        this.plugins = [];
        this.subscribeToEvents = [];
        this.eventsThrottleTime = 100;
        this.emblaChange = new EventEmitter();
        this.destroy$ = new Subject();
        this.storedOptions = this.options;
        this.storedPlugins = this.plugins;
        if (this.globalOptions) {
            EmblaCarousel.globalOptions = this.globalOptions;
        }
    }
    ngAfterViewInit() {
        if (!canUseDOM())
            return;
        this.ngZone.runOutsideAngular(() => {
            this.emblaApi = EmblaCarousel(this._elementRef.nativeElement, this.storedOptions, this.storedPlugins);
        });
        this.listenEvents();
    }
    ngOnChanges(changes) {
        const { plugins, options } = changes;
        if (options && !areOptionsEqual(this.storedOptions, options.currentValue)) {
            this.storedOptions = options.currentValue;
            this.reInit();
        }
        if (plugins && !arePluginsEqual(this.storedPlugins, plugins.currentValue)) {
            this.storedPlugins = plugins.currentValue;
            this.reInit();
        }
    }
    scrollTo(...args) {
        this.ngZone.runOutsideAngular(() => this.emblaApi?.scrollTo(...args));
    }
    scrollPrev(...args) {
        this.ngZone.runOutsideAngular(() => this.emblaApi?.scrollPrev(...args));
    }
    scrollNext(...args) {
        this.ngZone.runOutsideAngular(() => this.emblaApi?.scrollNext(...args));
    }
    reInit() {
        if (!this.emblaApi) {
            return;
        }
        this.ngZone.runOutsideAngular(() => {
            this.emblaApi?.reInit(this.storedOptions, this.storedPlugins);
        });
    }
    /**
     * `eventsThrottler$` Subject was made just because `scroll` event fires too often.
     */
    listenEvents() {
        if (this.subscribeToEvents.length === 0) {
            return;
        }
        const eventsThrottler$ = new Subject();
        eventsThrottler$
            .pipe(throttleTime(this.eventsThrottleTime), takeUntil(this.destroy$))
            .subscribe(eventName => {
            this.ngZone.run(() => this.emblaChange.emit(eventName));
        });
        this.ngZone.runOutsideAngular(() => {
            this.subscribeToEvents.forEach(eventName => {
                this.emblaApi.on(eventName, () => eventsThrottler$.next(eventName));
            });
        });
    }
    ngOnDestroy() {
        this.emblaApi?.destroy();
        this.destroy$.next();
        this.destroy$.complete();
    }
}
EmblaCarouselDirective.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: EmblaCarouselDirective, deps: [], target: i0.ɵɵFactoryTarget.Directive });
EmblaCarouselDirective.ɵdir = i0.ɵɵngDeclareDirective({ minVersion: "14.0.0", version: "14.3.0", type: EmblaCarouselDirective, isStandalone: true, selector: "[emblaCarousel]", inputs: { options: "options", plugins: "plugins", subscribeToEvents: "subscribeToEvents", eventsThrottleTime: "eventsThrottleTime" }, outputs: { emblaChange: "emblaChange" }, exportAs: ["emblaCarousel"], usesOnChanges: true, ngImport: i0 });
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "14.3.0", ngImport: i0, type: EmblaCarouselDirective, decorators: [{
            type: Directive,
            args: [{
                    selector: '[emblaCarousel]',
                    exportAs: 'emblaCarousel',
                    standalone: true,
                }]
        }], ctorParameters: function () { return []; }, propDecorators: { options: [{
                type: Input
            }], plugins: [{
                type: Input
            }], subscribeToEvents: [{
                type: Input
            }], eventsThrottleTime: [{
                type: Input
            }], emblaChange: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiZW1ibGEtY2Fyb3VzZWwuZGlyZWN0aXZlLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL2xpYi9lbWJsYS1jYXJvdXNlbC5kaXJlY3RpdmUudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsT0FBTyxFQUVMLFNBQVMsRUFDVCxVQUFVLEVBQ1YsWUFBWSxFQUNaLEtBQUssRUFDTCxNQUFNLEVBR04sTUFBTSxFQUVOLE1BQU0sR0FDUCxNQUFNLGVBQWUsQ0FBQTtBQUN0QixPQUFPLGFBS04sTUFBTSxnQkFBZ0IsQ0FBQTtBQUN2QixPQUFPLEVBQ0wsZUFBZSxFQUNmLGVBQWUsRUFDZixTQUFTLEdBQ1YsTUFBTSwrQkFBK0IsQ0FBQTtBQUN0QyxPQUFPLEVBQUUsT0FBTyxFQUFFLFNBQVMsRUFBRSxZQUFZLEVBQUUsTUFBTSxNQUFNLENBQUE7QUFDdkQsT0FBTyxFQUFFLG1CQUFtQixFQUFFLE1BQU0sU0FBUyxDQUFBOztBQU83QyxNQUFNLE9BQU8sc0JBQXNCO0lBaUJqQztRQWhCUSxrQkFBYSxHQUFHLE1BQU0sQ0FBQyxtQkFBbUIsQ0FBQyxDQUFBO1FBQzNDLFdBQU0sR0FBRyxNQUFNLENBQUMsTUFBTSxDQUFDLENBQUE7UUFDckIsZ0JBQVcsR0FBRyxNQUFNLENBQTBCLFVBQVUsQ0FBQyxDQUFBO1FBRTFELFlBQU8sR0FBcUIsRUFBRSxDQUFBO1FBQzlCLFlBQU8sR0FBc0IsRUFBRSxDQUFBO1FBQy9CLHNCQUFpQixHQUFxQixFQUFFLENBQUE7UUFDeEMsdUJBQWtCLEdBQUcsR0FBRyxDQUFBO1FBRWQsZ0JBQVcsR0FBRyxJQUFJLFlBQVksRUFBa0IsQ0FBQTtRQUUzRCxhQUFRLEdBQUcsSUFBSSxPQUFPLEVBQVEsQ0FBQTtRQUM5QixrQkFBYSxHQUFHLElBQUksQ0FBQyxPQUFPLENBQUE7UUFDNUIsa0JBQWEsR0FBRyxJQUFJLENBQUMsT0FBTyxDQUFBO1FBSWxDLElBQUksSUFBSSxDQUFDLGFBQWEsRUFBRTtZQUN0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aUJBQWlCLENBQUMsR0FBRyxFQUFFO1lBQ2pDLElBQUksQ0FBQyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEVBQUU7Z0JBQ3pDLElBQUksQ0FBQyxRQUFTLENBQUMsRUFBRSxDQUFDLFNBQVMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxnQkFBZ0IsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUMsQ0FBQTtZQUN0RSxDQUFDLENBQUMsQ0FBQTtRQUNKLENBQUMsQ0FBQyxDQUFBO0lBQ0osQ0FBQztJQUVELFdBQVc7UUFDVCxJQUFJLENBQUMsUUFBUSxFQUFFLE9BQU8sRUFBRSxDQUFBO1FBQ3hCLElBQUksQ0FBQyxRQUFRLENBQUMsSUFBSSxFQUFFLENBQUE7UUFDcEIsSUFBSSxDQUFDLFFBQVEsQ0FBQyxRQUFRLEVBQUUsQ0FBQTtJQUMxQixDQUFDOzttSEFsR1Usc0JBQXNCO3VHQUF0QixzQkFBc0I7MkZBQXRCLHNCQUFzQjtrQkFMbEMsU0FBUzttQkFBQztvQkFDVCxRQUFRLEVBQUUsaUJBQWlCO29CQUMzQixRQUFRLEVBQUUsZUFBZTtvQkFDekIsVUFBVSxFQUFFLElBQUk7aUJBQ2pCOzBFQU1VLE9BQU87c0JBQWYsS0FBSztnQkFDRyxPQUFPO3NCQUFmLEtBQUs7Z0JBQ0csaUJBQWlCO3NCQUF6QixLQUFLO2dCQUNHLGtCQUFrQjtzQkFBMUIsS0FBSztnQkFFYSxXQUFXO3NCQUE3QixNQUFNIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQWZ0ZXJWaWV3SW5pdCxcbiAgRGlyZWN0aXZlLFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIElucHV0LFxuICBOZ1pvbmUsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPdXRwdXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIGluamVjdCxcbn0gZnJvbSAnQGFuZ3VsYXIvY29yZSdcbmltcG9ydCBFbWJsYUNhcm91c2VsLCB7XG4gIEVtYmxhQ2Fyb3VzZWxUeXBlLFxuICBFbWJsYUV2ZW50VHlwZSxcbiAgRW1ibGFPcHRpb25zVHlwZSxcbiAgRW1ibGFQbHVnaW5UeXBlLFxufSBmcm9tICdlbWJsYS1jYXJvdXNlbCdcbmltcG9ydCB7XG4gIGFyZU9wdGlvbnNFcXVhbCxcbiAgYXJlUGx1Z2luc0VxdWFsLFxuICBjYW5Vc2VET00sXG59IGZyb20gJ2VtYmxhLWNhcm91c2VsLXJlYWN0aXZlLXV0aWxzJ1xuaW1wb3J0IHsgU3ViamVjdCwgdGFrZVVudGlsLCB0aHJvdHRsZVRpbWUgfSBmcm9tICdyeGpzJ1xuaW1wb3J0IHsgRU1CTEFfT1BUSU9OU19UT0tFTiB9IGZyb20gJy4vdXRpbHMnXG5cbkBEaXJlY3RpdmUoe1xuICBzZWxlY3RvcjogJ1tlbWJsYUNhcm91c2VsXScsXG4gIGV4cG9ydEFzOiAnZW1ibGFDYXJvdXNlbCcsXG4gIHN0YW5kYWxvbmU6IHRydWUsXG59KVxuZXhwb3J0IGNsYXNzIEVtYmxhQ2Fyb3VzZWxEaXJlY3RpdmUgaW1wbGVtZW50cyBBZnRlclZpZXdJbml0LCBPbkNoYW5nZXMsIE9uRGVzdHJveSB7XG4gIHByaXZhdGUgZ2xvYmFsT3B0aW9ucyA9IGluamVjdChFTUJMQV9PUFRJT05TX1RPS0VOKVxuICBwcml2YXRlIG5nWm9uZSA9IGluamVjdChOZ1pvbmUpXG4gIHByb3RlY3RlZCBfZWxlbWVudFJlZiA9IGluamVjdDxFbGVtZW50UmVmPEhUTUxFbGVtZW50Pj4oRWxlbWVudFJlZilcblxuICBASW5wdXQoKSBvcHRpb25zOiBFbWJsYU9wdGlvbnNUeXBlID0ge31cbiAgQElucHV0KCkgcGx1Z2luczogRW1ibGFQbHVnaW5UeXBlW10gPSBbXVxuICBASW5wdXQoKSBzdWJzY3JpYmVUb0V2ZW50czogRW1ibGFFdmVudFR5cGVbXSA9IFtdXG4gIEBJbnB1dCgpIGV2ZW50c1Rocm90dGxlVGltZSA9IDEwMFxuXG4gIEBPdXRwdXQoKSByZWFkb25seSBlbWJsYUNoYW5nZSA9IG5ldyBFdmVudEVtaXR0ZXI8RW1ibGFFdmVudFR5cGU+KClcblxuICBwcml2YXRlIGRlc3Ryb3kkID0gbmV3IFN1YmplY3Q8dm9pZD4oKVxuICBwcml2YXRlIHN0b3JlZE9wdGlvbnMgPSB0aGlzLm9wdGlvbnNcbiAgcHJpdmF0ZSBzdG9yZWRQbHVnaW5zID0gdGhpcy5wbHVnaW5zXG4gIGVtYmxhQXBpPzogRW1ibGFDYXJvdXNlbFR5cGVcblxuICBjb25zdHJ1Y3RvcigpIHtcbiAgICBpZiAodGhpcy5nbG9iYWxPcHRpb25zKSB7XG4gICAgICBFbWJsYUNhcm91c2VsLmdsb2JhbE9wdGlvbnMgPSB0aGlzLmdsb2JhbE9wdGlvbnNcbiAgICB9XG4gIH1cblxuICBuZ0FmdGVyVmlld0luaXQoKTogdm9pZCB7XG4gICAgaWYgKCFjYW5Vc2VET00oKSkgcmV0dXJuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5lbWJsYUFwaSA9IEVtYmxhQ2Fyb3VzZWwoXG4gICAgICAgIHRoaXMuX2VsZW1lbnRSZWYubmF0aXZlRWxlbWVudCxcbiAgICAgICAgdGhpcy5zdG9yZWRPcHRpb25zLFxuICAgICAgICB0aGlzLnN0b3JlZFBsdWdpbnMsXG4gICAgICApXG4gICAgfSlcbiAgICB0aGlzLmxpc3RlbkV2ZW50cygpXG4gIH1cblxuICBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKTogdm9pZCB7XG4gICAgY29uc3QgeyBwbHVnaW5zLCBvcHRpb25zIH0gPSBjaGFuZ2VzXG5cbiAgICBpZiAob3B0aW9ucyAmJiAhYXJlT3B0aW9uc0VxdWFsKHRoaXMuc3RvcmVkT3B0aW9ucywgb3B0aW9ucy5jdXJyZW50VmFsdWUpKSB7XG4gICAgICB0aGlzLnN0b3JlZE9wdGlvbnMgPSBvcHRpb25zLmN1cnJlbnRWYWx1ZVxuICAgICAgdGhpcy5yZUluaXQoKVxuICAgIH1cblxuICAgIGlmIChwbHVnaW5zICYmICFhcmVQbHVnaW5zRXF1YWwodGhpcy5zdG9yZWRQbHVnaW5zLCBwbHVnaW5zLmN1cnJlbnRWYWx1ZSkpIHtcbiAgICAgIHRoaXMuc3RvcmVkUGx1Z2lucyA9IHBsdWdpbnMuY3VycmVudFZhbHVlXG4gICAgICB0aGlzLnJlSW5pdCgpXG4gICAgfVxuICB9XG5cbiAgc2Nyb2xsVG8oLi4uYXJnczogUGFyYW1ldGVyczxFbWJsYUNhcm91c2VsVHlwZVsnc2Nyb2xsVG8nXT4pOiB2b2lkIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmVtYmxhQXBpPy5zY3JvbGxUbyguLi5hcmdzKSlcbiAgfVxuXG4gIHNjcm9sbFByZXYoLi4uYXJnczogUGFyYW1ldGVyczxFbWJsYUNhcm91c2VsVHlwZVsnc2Nyb2xsUHJldiddPik6IHZvaWQge1xuICAgIHRoaXMubmdab25lLnJ1bk91dHNpZGVBbmd1bGFyKCgpID0+IHRoaXMuZW1ibGFBcGk/LnNjcm9sbFByZXYoLi4uYXJncykpXG4gIH1cblxuICBzY3JvbGxOZXh0KC4uLmFyZ3M6IFBhcmFtZXRlcnM8RW1ibGFDYXJvdXNlbFR5cGVbJ3Njcm9sbE5leHQnXT4pOiB2b2lkIHtcbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB0aGlzLmVtYmxhQXBpPy5zY3JvbGxOZXh0KC4uLmFyZ3MpKVxuICB9XG5cbiAgcmVJbml0KCkge1xuICAgIGlmICghdGhpcy5lbWJsYUFwaSkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgdGhpcy5uZ1pvbmUucnVuT3V0c2lkZUFuZ3VsYXIoKCkgPT4ge1xuICAgICAgdGhpcy5lbWJsYUFwaT8ucmVJbml0KHRoaXMuc3RvcmVkT3B0aW9ucywgdGhpcy5zdG9yZWRQbHVnaW5zKVxuICAgIH0pXG4gIH1cblxuICAvKipcbiAgICogYGV2ZW50c1Rocm90dGxlciRgIFN1YmplY3Qgd2FzIG1hZGUganVzdCBiZWNhdXNlIGBzY3JvbGxgIGV2ZW50IGZpcmVzIHRvbyBvZnRlbi5cbiAgICovXG4gIHByaXZhdGUgbGlzdGVuRXZlbnRzKCk6IHZvaWQge1xuICAgIGlmICh0aGlzLnN1YnNjcmliZVRvRXZlbnRzLmxlbmd0aCA9PT0gMCkge1xuICAgICAgcmV0dXJuXG4gICAgfVxuXG4gICAgY29uc3QgZXZlbnRzVGhyb3R0bGVyJCA9IG5ldyBTdWJqZWN0PEVtYmxhRXZlbnRUeXBlPigpXG5cbiAgICBldmVudHNUaHJvdHRsZXIkXG4gICAgICAucGlwZSh0aHJvdHRsZVRpbWUodGhpcy5ldmVudHNUaHJvdHRsZVRpbWUpLCB0YWtlVW50aWwodGhpcy5kZXN0cm95JCkpXG4gICAgICAuc3Vic2NyaWJlKGV2ZW50TmFtZSA9PiB7XG4gICAgICAgIHRoaXMubmdab25lLnJ1bigoKSA9PiB0aGlzLmVtYmxhQ2hhbmdlLmVtaXQoZXZlbnROYW1lKSlcbiAgICAgIH0pXG5cbiAgICB0aGlzLm5nWm9uZS5ydW5PdXRzaWRlQW5ndWxhcigoKSA9PiB7XG4gICAgICB0aGlzLnN1YnNjcmliZVRvRXZlbnRzLmZvckVhY2goZXZlbnROYW1lID0+IHtcbiAgICAgICAgdGhpcy5lbWJsYUFwaSEub24oZXZlbnROYW1lLCAoKSA9PiBldmVudHNUaHJvdHRsZXIkLm5leHQoZXZlbnROYW1lKSlcbiAgICAgIH0pXG4gICAgfSlcbiAgfVxuXG4gIG5nT25EZXN0cm95KCk6IHZvaWQge1xuICAgIHRoaXMuZW1ibGFBcGk/LmRlc3Ryb3koKVxuICAgIHRoaXMuZGVzdHJveSQubmV4dCgpXG4gICAgdGhpcy5kZXN0cm95JC5jb21wbGV0ZSgpXG4gIH1cbn1cbiJdfQ==